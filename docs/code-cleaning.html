<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Fiscal Futures Project - 2&nbsp; Gathering and Cleaning Data!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./FedMoneyReceived.html" rel="next">
<link href="./FundsIncluded.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Fiscal Futures Project</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./FiscalGap.html">
 <span class="menu-text">The FY22 Fiscal Gap</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./FedMoneyReceived.html">
 <span class="menu-text">COVID-related Federal Revenue</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-methodology" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Methodology</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-methodology">    
        <li>
    <a class="dropdown-item" href="./FundsIncluded.html">
 <span class="dropdown-text">An All Funds Approach</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./code-cleaning.html">
 <span class="dropdown-text">Gathering and Cleaning Data!</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./FedMoneyReceived.html">
 <span class="dropdown-text">Federal COVID Money Received</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./LocalTransfers.html">
 <span class="dropdown-text">Local Transfers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Debt.html">
 <span class="dropdown-text">Debt Service Discussion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Pensions.html">
 <span class="dropdown-text">Pensions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Healthcare.html">
 <span class="dropdown-text">State Employee Healthcare Discussion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./FederalRevenue.html">
 <span class="dropdown-text">Federal Revenue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Medicaid.html">
 <span class="dropdown-text">Medicaid</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Everything.html">
 <span class="dropdown-text">Calculating the Fiscal Gap</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/AleaWM/Fiscal-Futures"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Background Information</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FundsIncluded.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An All Funds Approach</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code-cleaning.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FedMoneyReceived.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Federal COVID Money Received</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LocalTransfers.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Local Transfers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Debt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Debt Service Discussion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pensions.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pensions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Healthcare.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">State Employee Healthcare Discussion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FederalRevenue.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Federal Revenue</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Medicaid.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Medicaid</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FiscalGap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The FY22 Fiscal Gap</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Everything.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Calculating the Fiscal Gap</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#inspecting-new-fy22-data-files" id="toc-inspecting-new-fy22-data-files" class="nav-link active" data-scroll-target="#inspecting-new-fy22-data-files"><span class="toc-section-number">2.0.1</span>  Inspecting new FY22 data files</a></li>
  <li><a href="#finding-new-agencies-and-funds" id="toc-finding-new-agencies-and-funds" class="nav-link" data-scroll-target="#finding-new-agencies-and-funds"><span class="toc-section-number">2.0.2</span>  Finding new agencies and funds</a></li>
  <li><a href="#recoding-new-and-reused-funds" id="toc-recoding-new-and-reused-funds" class="nav-link" data-scroll-target="#recoding-new-and-reused-funds"><span class="toc-section-number">2.0.3</span>  Recoding New and Reused Funds</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-gathering-and-cleaning-data" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Information for the Fiscal Futures all funds database comes from detailed information provided by the Illinois Comptrollerâ€™s office.&nbsp; Currently the database includes 300,000 individual records for fiscal years 1998 to 2022.</p>
<ul>
<li>Do the FOIA request. In a week or so, they send the expenditure and revenue data as excel files.</li>
<li>Checks whether there are any new agencies, re-used funds etc. Create a list of funds, agencies, fund names, etc. for the new year and compare it to the immediate prior year to identify new funds.</li>
<li>Update the funds_ab_in file which shows the use of funds. Use criteria to determine if the new funds should be in or out of the all-funds frame.</li>
<li>Change the variable names to be consistent with other files such as AGENCYNAME --&gt; agency_name</li>
<li>Once variable names are shared over all years of data, combine past years with newest year. All revenue files are in a `revenue` folder that I reference when I set the working directory. When adding new fiscal years, put the the newest year of data for revenue and expenditures in their respective folders.</li>
</ul>
<p>Normally, when your receive the new fiscal year files from the Comptrollers office, you will need to change the variable names so that they are consistent with past years. This is an example of reading in the new file and changing the variable names. They seem to change almost every year in the file received from the FOIA so if the code breaks here, check to make sure that the columns you are trying to rename exist and are spelled correctly! Once variables are the same, you will want to save the file as a csv file in its Revenue/Expenditure file and bind all past years and the current year together in one dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Example code below: Read in excel file and rename columns so that it plays well with the other years' files.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>revenue_fy22 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Fis_Fut_Rev_2022_Final.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FY'</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">'REVENUE SOURCE'</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">source_name =</span> <span class="st">'REV SRC NAME'</span>,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">receipts =</span> <span class="st">'AMOUNT'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>exp_fy22 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Fis_Fut_Exp_2022_Final.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FY'</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">appr_org =</span> <span class="st">'ORGANIZATION'</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">org_name =</span> <span class="st">'ORGANIZATION NAME'</span>,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">obj_seq_type =</span> <span class="st">'APPROPRIATION'</span>,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">wh_approp_name =</span> <span class="st">'APPROPRIATION NAME'</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># exp_net_xfer = 'NET OF TRANS AMOUNT',</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">expenditure =</span> <span class="st">'EXPENDED'</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># %&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   # these come from ioc_source file after merging</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(data_source = "exp IOC Aug 2022",</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#          object = ,</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#          seq = ,</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#          type = ,</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_cat = FIND_COLUMN, #create fund_cat column</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_cat_name = FIND_NAME) # create fund_cat_name column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below takes the .dta files for all fiscal years before FY 2022 and binds them together. Variable names were manually changed by past researchers so that they were consistent across years.</p>
<p>For FY 2023 and after, .dta files can be avoided entirely and .csv or excel files will be used. All files before this year had been saved and passed on as .dta files for Stata code before the transition to R in Fall 2022. For years after fy22: add line of code to bind csv files after binding the dta files together. Variable names must identical to merge files together.</p>
<p>Code below reads in the csv files created in chunks above (allrevfiles.csv and allrexpfiles.csv). These files contain all years of data combined into one file BEFORE any recoding is done. Do not use this file for summing categories because it is just an inbetween step before recoding revenue and expenditure categories.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combined in past chunks called create-rev-csv and create-exp-csv</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>allrevfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allrevfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>allexpfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allexpfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="inspecting-new-fy22-data-files" class="level3" data-number="2.0.1">
<h3 data-number="2.0.1" class="anchored" data-anchor-id="inspecting-new-fy22-data-files"><span class="header-section-number">2.0.1</span> Inspecting new FY22 data files</h3>
<p>Data files for closed years have been obtained from IOC. The numbers of funds, agencies, organizations, and revenue sources below were found by using pivot tables in the codebook files in the FY2022 Box folder. This could also be done using R and grouping new files by fund, agency, source number, source names, etc..</p>
<p>Revenue File:</p>
<ul>
<li>684 Fund Numbers</li>
<li>80 Agencies</li>
<li>1184 Revenue source numbers</li>
<li>1156 revenue source names</li>
</ul>
<p>Expenditure File:</p>
<ul>
<li>708 Fund Numbers</li>
<li>107 Agencies</li>
<li>98 Organization Numbers</li>
<li>313 Organization names</li>
</ul>
</section>
<section id="finding-new-agencies-and-funds" class="level3" data-number="2.0.2">
<h3 data-number="2.0.2" class="anchored" data-anchor-id="finding-new-agencies-and-funds"><span class="header-section-number">2.0.2</span> Finding new agencies and funds</h3>
<p>General steps:</p>
<ol type="1">
<li>Identify new and reused funds for newest fiscal year.</li>
<li>Recode funds to take into account different fund numbers/names over the years. See [Recoding New and Reused Funds] for code chunk that does this.</li>
<li>Update fund_ab_in_2022.xlsx with any changes from previous fiscal year.</li>
</ol>
<p><strong>New Agencies, Funds, and Organizations from Expenditure files:</strong></p>
<ul>
<li>Using the code below, I found 2 agencies, multiple funds, and a couple organizations that had not been specifically mentioned in the funds_ab_in file - AWM, FY2022.</li>
<li>Note: One new org name and org number combo has an expenditure of $600 million for pensions payment. Investigate later.</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>allrevfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allrevfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>allexpfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allexpfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Expenditure Data #####</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies referenced in any year before 2020:</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allexpfiles22 <span class="sc">%&gt;%</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 146 agencies ever</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies in 2022 data:</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>agencies22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies22 # 107 agencies this year</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 280 and 533 are new agency codes: </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies22, agencies_past, </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["agency"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["agency_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["expenditure"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"280","2":"COURTS COMMISSION","3":"37746.77"},{"1":"533","2":"COMM ON EQUITY & INCLUSION","3":"1405787.59"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>funds22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 15 funds were in FY22 data that were not in past data:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds22, funds_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(fund)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["fund"],"name":[1],"type":["chr"],"align":["left"]},{"label":["fund_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["count"],"name":[3],"type":["int"],"align":["right"]},{"label":["Expenditure"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0110","2":"DEV. DISABILITIES AWARENESS","3":"1","4":"0.0"},{"1":"0319","2":"PENSION STABILIZATION","3":"10","4":"300000000.0"},{"1":"0351","2":"FREEDOM SCHOOLS","3":"1","4":"335306.0"},{"1":"0367","2":"CAP FACILITY TEC MODERNIZATION","3":"2","4":"1000000.0"},{"1":"0392","2":"EQUAL PAY REGISTRATION","3":"1","4":"0.0"},{"1":"0393","2":"SICKLE CELL CHRONIC DISEASE","3":"1","4":"0.0"},{"1":"0422","2":"ELECTRIC VEHICLE REBATE","3":"3","4":"225069.2"},{"1":"0427","2":"ENERGY TRANSITION ASSISTANCE","3":"8","4":"6046483.2"},{"1":"0461","2":"PARITY ADVANCEMENT","3":"1","4":"0.0"},{"1":"0544","2":"DOIT SPECIAL PROJECTS","3":"3","4":"9998631.5"},{"1":"0628","2":"ESSENTIAL GOVT SERV SUPPORT","3":"1","4":"736120866.9"},{"1":"0634","2":"STATE TREASURER'S CAPITAL","3":"1","4":"250000.0"},{"1":"0656","2":"HORSE RACING PURSE EQUITY","3":"1","4":"5908047.6"},{"1":"0672","2":"CONSUMER INTERVENOR COMP.","3":"1","4":"2665.0"},{"1":"0976","2":"FAIRGROUNDS IMPROVMNT & RACING","3":"1","4":"10000.0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_pastin the past =  916 org groups ever</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>orgs_past <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(appr_org <span class="sc">==</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_past # 916 org groups ever</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>orgs22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">appr_org =</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs22 # 396 org groups this year</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 org number and org name combos are new for FY2022:</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(orgs22, orgs_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"appr_org"</span>, <span class="st">"org_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(appr_org)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["appr_org"],"name":[1],"type":["chr"],"align":["left"]},{"label":["org_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Expenditure"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"05","2":"PAROLE","3":"53426135.27"},{"1":"06","2":"RE-ENTRY SERVICES","3":"18338411.05"},{"1":"25","2":"RETIREMENT SYSTEM PMT ADMIN","3":"600000000.00"},{"1":"34","2":"IL CRIMINAL JUSTICE INFO AUTH","3":"55659.04"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><strong>New Revenue Funds, Sources, and New Agencies:</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Revenue Data ####</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 108 agencies ever</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies22 # 80 agencies this year</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>agencies22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 new agencies in revenue data this year</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies22, agencies_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(agency)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["agency"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["agency_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Receipts"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>funds22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 19 revenue funds were in FY22 revenue data that were not in past data </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small fund name changes</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds22, funds_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(fund)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["fund"],"name":[1],"type":["chr"],"align":["left"]},{"label":["fund_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["count"],"name":[3],"type":["int"],"align":["right"]},{"label":["Receipts"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0165","2":"RONALD MCDONALD HOUSE CHARITY","3":"1","4":"1.438928e+05"},{"1":"0319","2":"PENSION STABILIZATION","3":"1","4":"3.000000e+08"},{"1":"0351","2":"FREEDOM SCHOOLS","3":"1","4":"1.700000e+07"},{"1":"0367","2":"CAP FACILITY TEC MODERNIZATION","3":"1","4":"5.300000e+06"},{"1":"0392","2":"EQUAL PAY REGISTRATION","3":"1","4":"2.415000e+04"},{"1":"0422","2":"ELECTRIC VEHICLE REBATE","3":"3","4":"1.352880e+07"},{"1":"0427","2":"ENERGY TRANSITION ASSISTANCE","3":"1","4":"2.877307e+07"},{"1":"0544","2":"DOIT SPECIAL PROJECTS","3":"2","4":"9.998632e+06"},{"1":"0628","2":"ESSENTIAL GOVT SERV SUPPORT","3":"1","4":"1.000000e+09"},{"1":"0634","2":"STATE TREASURER'S CAPITAL","3":"2","4":"2.731917e+05"},{"1":"0656","2":"HORSE RACING PURSE EQUITY","3":"1","4":"5.908048e+06"},{"1":"0672","2":"CONSUMER INTERVENOR COMP.","3":"1","4":"1.220000e+06"},{"1":"0683","2":"GROCERY TAX REPLACEMENT","3":"1","4":"3.250000e+08"},{"1":"0723","2":"REVOCATION ENFORCEMENT","3":"1","4":"7.490730e+05"},{"1":"0742","2":"ST. POLICE TRAINING & ACADEMY","3":"1","4":"2.803359e+06"},{"1":"0743","2":"LAW ENFORCEMENT TRAINING","3":"1","4":"2.523023e+07"},{"1":"0848","2":"SETTLEMENT","3":"1","4":"5.000000e+06"},{"1":"0966","2":"ILLINOIS WORKS","3":"1","4":"1.000000e+07"},{"1":"0976","2":"FAIRGROUNDS IMPROVMNT & RACING","3":"3","4":"9.366357e+04"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sources_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>sources22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 revenue sources were in FY22 data that were not in past data </span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small source name changes:</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(sources22, sources_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span>, <span class="st">"source_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["source"],"name":[1],"type":["chr"],"align":["left"]},{"label":["source_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["count"],"name":[3],"type":["int"],"align":["right"]},{"label":["Receipts"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"0303","2":"LOTTERY-ILOTTERY SETTLEMENT","3":"1","4":"177417302.14"},{"1":"2292","2":"VIDEO TERMINAL TAX","3":"3","4":"893824161.56"},{"1":"2457","2":"E ST LOUIS FINANCE AUTH","3":"1","4":"41666.67"},{"1":"2590","2":"ALTON CENTER BUSINESS PARK","3":"1","4":"291666.69"},{"1":"2611","2":"E-PAY ADMINISTRATION FEES","3":"1","4":"1136120.58"},{"1":"2660","2":"CONCESSION REVENUE-FOOD","3":"1","4":"17210.04"},{"1":"2682","2":"SW BADGE REPLACEMENT FEES","3":"1","4":"10.00"},{"1":"2699","2":"RB RECONCILIATION FEE","3":"1","4":"15000000.00"},{"1":"2729","2":"NORTH PARK COLLEGE LIC PLATES","3":"1","4":"20.00"},{"1":"2736","2":"STATE ST INSTITNL US GOV FND","3":"1","4":"1622448.06"},{"1":"2737","2":"VGA - IL STATE FAIR OP FEES","3":"1","4":"48387.30"},{"1":"2738","2":"VGA-DU QUOIN STATE FAIR OP FEE","3":"1","4":"11029.15"},{"1":"2739","2":"PUBLIC UTILITIES","3":"1","4":"1220000.00"},{"1":"2740","2":"ENRGY TRANSITION ASST/ELECTRIC","3":"1","4":"28773074.81"},{"1":"2742","2":"OPERATION ASSESSMENT FEE","3":"1","4":"2828085.38"},{"1":"2745","2":"FY22 TITLE INCREASE","3":"1","4":"3072054.00"},{"1":"2747","2":"BUSINESS FILING FEE","3":"1","4":"24150.00"},{"1":"2748","2":"CORN COMMODITY SPONSORS","3":"1","4":"5000.00"},{"1":"2755","2":"PUBLIC UTIL - ETHICS REPRT FEE","3":"1","4":"1235000.00"},{"1":"2756","2":"UNEXP CAPITAL IMP PROJECTS","3":"1","4":"90582.98"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Sources 2737 through 2756 were not found in the IOC_source file so I added them to <code>ioc_source_updated22_AWM.xlsx</code>. Revenue source types were found manually using the Comptrollerâ€™s website and searching for each source listed above and identifying its type. Then the ioc_source excel file was updated to include the revenue type (Completed Jan.&nbsp;20 2023, AFTER the FY22 paper totals were calculated. There were very minor differences in aggregated expenditures and revenues.) <code>ioc_source_updated22_AWM.xlsx</code> will become the generic <code>ioc_source.xlsx</code> file in the future.</p>
</section>
<section id="recoding-new-and-reused-funds" class="level3" data-number="2.0.3">
<h3 data-number="2.0.3" class="anchored" data-anchor-id="recoding-new-and-reused-funds"><span class="header-section-number">2.0.3</span> Recoding New and Reused Funds</h3>
<p>New funds will need to be manually added to the funds_ab_in excel file and determined if they should or should not be included in Fiscal Future calculations.</p>
<p>For funds that were reused once, a 9 replaces the 0 as the first digit. If reused twice, then the first two values are 10.</p>
<ul>
<li>Ex. 0350 --&gt; 9350 because its use changed.</li>
<li>Ex. 0367 becomes 10367 because its use has changed twice now. There was fund 0367 originally, then its use changed and it was recoded as 9367, and now it changed again so it is a 10367.</li>
<li>Excel file also has alternative ways to name funds (e.g.&nbsp;0397-A and 0397-B) and variables for the year that the fund stopped being used. These have not been updated consistently over the years but it is useful information when trying to find any coding mistakes from the past.</li>
</ul>
<p>New or reused funds revenue file recoding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9 if its purpose has changed</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>rev_1998_2022 <span class="ot">&lt;-</span> allrevfiles22 <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span> (fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>   <span class="co">#2022 changes</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>, <span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For 2022, new funds included The Essential Government Services fund, Electric Vehicle Rebate, Budget Stabilization fund, and more. New funds were added to the funds_ab_in.xlsx file and recoded funds were addressed in the code chunks below and updated in the same excel file.</p>
<p>Expenditure recoding:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>exp_1998_2022 <span class="ot">&lt;-</span> allexpfiles22 <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund))  <span class="sc">%&gt;%</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#2022 changes</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>,<span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time </span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>funds_ab_in.xlsx</code> file contains all funds that have existed since 1998, if they still exist, indicates if fund numbers have been reused for varying purposes, and is updated yearly with new fund numbers used by the IOC.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>funds_ab_in_2022 <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/funds_ab_in_2022.xlsx"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_1998_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fund, fy) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(expenditure <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>             <span class="co"># keeps everything that is not zero</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># join  funds_ab_in_2021  to exp_temp</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">left_join</span>(funds_ab_in_2022, <span class="at">by =</span> <span class="st">"fund"</span>)  <span class="co"># matches most recent fund number </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Agency == 799 for Statutory transfers </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  Object == 1993 is for Interfund cash transfers  </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_agency =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="fu">str_sub</span>(obj_seq_type,<span class="dv">1</span>,<span class="dv">3</span>), trans_agency),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_type =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="fu">str_sub</span>(obj_seq_type,<span class="dv">4</span>,<span class="dv">9</span>), trans_type)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>the initial combined years of data are saved as dataframes named <code>exp_1998_2022</code> and <code>rev_1998_2022</code>. These are then saved as exp_temp and rev_temp while recoding variables. This is BEFORE category groups are created and cleaned below. <code>exp_temp</code> and <code>rev_temp</code> are only temporary files; do not use for aggregating totals yet!</li>
</ul>
<p>Update Agencies: Some agencies have merged with others or changed names over time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency)))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For aggregating revenue, use the rev_1998_2022 dataframe, join the funds_ab_in_2022 file to it, and then join the ioc_source_type file to the dataset. Remember: You need to update the funds_ab_in and ioc_source_type file every year!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fund info to revenue for all years</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rev_1998_2022, funds_ab_in_2022, <span class="at">by =</span> <span class="st">"fund"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(source)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># need to update the ioc_source_type file every year! </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ioc_source_type <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/ioc_source_updated22_AWM.xlsx"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rev_temp, ioc_source_type, <span class="at">by =</span> <span class="st">"source"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically used source, source name does not match for the join to work using source_name</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>, <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(rev_temp, <span class="at">file =</span> <span class="st">"rev_temp.csv"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(exp_temp, <span class="at">file =</span> <span class="st">"exp_temp.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./FundsIncluded.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An All Funds Approach</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./FedMoneyReceived.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Federal COVID Money Received</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Gathering and Cleaning Data! {#sec-gathering-and-cleaning-data}</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning = FALSE, message=FALSE}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formatR)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smooth)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geofacet)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>Information for the Fiscal Futures all funds database comes from detailed information provided by the Illinois Comptroller's office.&nbsp; Currently the database includes 300,000 individual records for fiscal years 1998 to 2022.</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do the FOIA request. In a week or so, they send the expenditure and revenue data as excel files.</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Checks whether there are any new agencies, re-used funds etc. Create a list of funds, agencies, fund names, etc. for the new year and compare it to the immediate prior year to identify new funds.</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Update the funds_ab_in file which shows the use of funds. Use criteria to determine if the new funds should be in or out of the all-funds frame.</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Change the variable names to be consistent with other files such as AGENCYNAME <span class="sc">\-</span>-<span class="sc">\&gt;</span> agency_name</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once variable names are shared over all years of data, combine past years with newest year. All revenue files are in a <span class="sc">\`</span>revenue<span class="sc">\`</span> folder that I reference when I set the working directory. When adding new fiscal years, put the the newest year of data for revenue and expenditures in their respective folders.</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>Normally, when your receive the new fiscal year files from the Comptrollers office, you will need to change the variable names so that they are consistent with past years. This is an example of reading in the new file and changing the variable names. They seem to change almost every year in the file received from the FOIA so if the code breaks here, check to make sure that the columns you are trying to rename exist and are spelled correctly! Once variables are the same, you will want to save the file as a csv file in its Revenue/Expenditure file and bind all past years and the current year together in one dataframe.</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="co">#Example code below: Read in excel file and rename columns so that it plays well with the other years' files.</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>revenue_fy22 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Fis_Fut_Rev_2022_Final.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FY'</span>,</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">'REVENUE SOURCE'</span>,</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">source_name =</span> <span class="st">'REV SRC NAME'</span>,</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">receipts =</span> <span class="st">'AMOUNT'</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>exp_fy22 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"Fis_Fut_Exp_2022_Final.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FY'</span>,</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>         <span class="at">appr_org =</span> <span class="st">'ORGANIZATION'</span>,</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">org_name =</span> <span class="st">'ORGANIZATION NAME'</span>,</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">obj_seq_type =</span> <span class="st">'APPROPRIATION'</span>,</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">wh_approp_name =</span> <span class="st">'APPROPRIATION NAME'</span>,</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># exp_net_xfer = 'NET OF TRANS AMOUNT',</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">expenditure =</span> <span class="st">'EXPENDED'</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a><span class="co"># %&gt;%</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   # these come from ioc_source file after merging</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(data_source = "exp IOC Aug 2022",</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a><span class="co">#          object = ,</span></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a><span class="co">#          seq = ,</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="co">#          type = ,</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_cat = FIND_COLUMN, #create fund_cat column</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_cat_name = FIND_NAME) # create fund_cat_name column</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>The code chunk below takes the .dta files for all fiscal years before FY 2022 and binds them together. Variable names were manually changed by past researchers so that they were consistent across years.</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>For FY 2023 and after, .dta files can be avoided entirely and .csv or excel files will be used. All files before this year had been saved and passed on as .dta files for Stata code before the transition to R in Fall 2022. For years after fy22: add line of code to bind csv files after binding the dta files together. Variable names must identical to merge files together.</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-rev-csv-FY22, include=FALSE, eval=FALSE}</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="co"># years after fy22: add line of code to bind csv files after binding the dta files.</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/revenue"</span>)</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>allrevfiles22 <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/revenue"</span>,  <span class="at">pattern =</span> <span class="st">".dta"</span>) <span class="sc">%&gt;%</span>  <span class="fu">lapply</span>(read_dta) <span class="sc">%&gt;%</span> bind_rows</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a><span class="co">#Fy21: 62294 observations, 13 variables</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="co">#FY22: 65094 obs, 13 vars</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allrevfiles22, <span class="st">"allrevfiles22.csv"</span>)</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/expenditures"</span>)</span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a>allexpfiles22 <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/expenditures"</span>,  <span class="at">pattern =</span> <span class="st">".dta"</span>) <span class="sc">%&gt;%</span>  <span class="fu">lapply</span>(read_dta) <span class="sc">%&gt;%</span> bind_rows</span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a><span class="co">#fy21 213372 observations, 20 variables</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a><span class="co"># fy22 225587 obs, 21 vars.</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allexpfiles22, <span class="st">"allexpfiles22.csv"</span>)</span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>Code below reads in the csv files created in chunks above (allrevfiles.csv and allrexpfiles.csv). These files contain all years of data combined into one file BEFORE any recoding is done. Do not use this file for summing categories because it is just an inbetween step before recoding revenue and expenditure categories.</span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r readCSVs}</span></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a><span class="co"># combined in past chunks called create-rev-csv and create-exp-csv</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>allrevfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allrevfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>allexpfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allexpfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspecting new FY22 data files</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>Data files for closed years have been obtained from IOC. The numbers of funds, agencies, organizations, and revenue sources below were found by using pivot tables in the codebook files in the FY2022 Box folder. This could also be done using R and grouping new files by fund, agency, source number, source names, etc..</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>Revenue File:</span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>684 Fund Numbers</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>80 Agencies</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1184 Revenue source numbers</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1156 revenue source names</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>Expenditure File:</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>708 Fund Numbers</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>107 Agencies</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>98 Organization Numbers</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>313 Organization names</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a><span class="fu">### Finding new agencies and funds</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>General steps:</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Identify new and reused funds for newest fiscal year.</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Recode funds to take into account different fund numbers/names over the years. See <span class="sc">\[</span>Recoding New and Reused Funds<span class="sc">\]</span> for code chunk that does this.</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Update fund_ab_in_2022.xlsx with any changes from previous fiscal year.</span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a>**New Agencies, Funds, and Organizations from Expenditure files:**</span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using the code below, I found 2 agencies, multiple funds, and a couple organizations that had not been specifically mentioned in the funds_ab_in file - AWM, FY2022.</span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note: One new org name and org number combo has an expenditure of \$600 million for pensions payment. Investigate later.</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a>allrevfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allrevfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>allexpfiles22 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"allexpfiles22.csv"</span>) <span class="co">#combined but not recoded</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Expenditure Data #####</span></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies referenced in any year before 2020:</span></span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allexpfiles22 <span class="sc">%&gt;%</span> </span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 146 agencies ever</span></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies in 2022 data:</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>agencies22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies22 # 107 agencies this year</span></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a><span class="co"># 280 and 533 are new agency codes: </span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies22, agencies_past, </span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>funds22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a><span class="co"># 15 funds were in FY22 data that were not in past data:</span></span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds22, funds_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(fund)</span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_pastin the past =  916 org groups ever</span></span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>orgs_past <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(appr_org <span class="sc">==</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_past # 916 org groups ever</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a>orgs22 <span class="ot">&lt;-</span> allexpfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">appr_org =</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs22 # 396 org groups this year</span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 org number and org name combos are new for FY2022:</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(orgs22, orgs_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"appr_org"</span>, <span class="st">"org_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(appr_org)</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>**New Revenue Funds, Sources, and New Agencies:**</span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Revenue Data ####</span></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 108 agencies ever</span></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies22 # 80 agencies this year</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>agencies22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 new agencies in revenue data this year</span></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies22, agencies_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(agency)</span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a>funds22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a><span class="co"># 19 revenue funds were in FY22 revenue data that were not in past data </span></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small fund name changes</span></span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds22, funds_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(fund)</span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>sources_past <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>sources22 <span class="ot">&lt;-</span> allrevfiles22  <span class="sc">%&gt;%</span> </span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a><span class="co"># 20 revenue sources were in FY22 data that were not in past data </span></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small source name changes:</span></span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(sources22, sources_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span>, <span class="st">"source_name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(source)</span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a>Sources 2737 through 2756 were not found in the IOC_source file so I added them to <span class="in">`ioc_source_updated22_AWM.xlsx`</span>. Revenue source types were found manually using the Comptroller's website and searching for each source listed above and identifying its type. Then the ioc_source excel file was updated to include the revenue type (Completed Jan. 20 2023, AFTER the FY22 paper totals were calculated. There were very minor differences in aggregated expenditures and revenues.) <span class="in">`ioc_source_updated22_AWM.xlsx`</span> will become the generic <span class="in">`ioc_source.xlsx`</span> file in the future.</span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recoding New and Reused Funds</span></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a>New funds will need to be manually added to the funds_ab_in excel file and determined if they should or should not be included in Fiscal Future calculations.</span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a>For funds that were reused once, a 9 replaces the 0 as the first digit. If reused twice, then the first two values are 10.</span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ex. 0350 <span class="sc">\-</span>-<span class="sc">\&gt;</span> 9350 because its use changed.</span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ex. 0367 becomes 10367 because its use has changed twice now. There was fund 0367 originally, then its use changed and it was recoded as 9367, and now it changed again so it is a 10367.</span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Excel file also has alternative ways to name funds (e.g. 0397-A and 0397-B) and variables for the year that the fund stopped being used. These have not been updated consistently over the years but it is useful information when trying to find any coding mistakes from the past.</span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a>New or reused funds revenue file recoding:</span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recode-rev-funds}</span></span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9 if its purpose has changed</span></span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a>rev_1998_2022 <span class="ot">&lt;-</span> allrevfiles22 <span class="sc">%&gt;%</span></span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span> (fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a>   <span class="co">#2022 changes</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>, <span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a>For 2022, new funds included The Essential Government Services fund, Electric Vehicle Rebate, Budget Stabilization fund, and more. New funds were added to the funds_ab_in.xlsx file and recoded funds were addressed in the code chunks below and updated in the same excel file.</span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>Expenditure recoding:</span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recode-exp-funds}</span></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9</span></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a>exp_1998_2022 <span class="ot">&lt;-</span> allexpfiles22 <span class="sc">%&gt;%</span></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund))  <span class="sc">%&gt;%</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a>  <span class="co">#2022 changes</span></span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>,<span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time </span></span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a>The <span class="in">`funds_ab_in.xlsx`</span> file contains all funds that have existed since 1998, if they still exist, indicates if fund numbers have been reused for varying purposes, and is updated yearly with new fund numbers used by the IOC.</span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-exp_temp, warning = FALSE, message = FALSE}</span></span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a>funds_ab_in_2022 <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/funds_ab_in_2022.xlsx"</span>)</span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_1998_2022 <span class="sc">%&gt;%</span> </span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fund, fy) <span class="sc">%&gt;%</span></span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(expenditure <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>             <span class="co"># keeps everything that is not zero</span></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a><span class="co"># join  funds_ab_in_2021  to exp_temp</span></span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a> <span class="fu">left_join</span>(funds_ab_in_2022, <span class="at">by =</span> <span class="st">"fund"</span>)  <span class="co"># matches most recent fund number </span></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Agency == 799 for Statutory transfers </span></span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a><span class="co">#  Object == 1993 is for Interfund cash transfers  </span></span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_agency =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="fu">str_sub</span>(obj_seq_type,<span class="dv">1</span>,<span class="dv">3</span>), trans_agency),</span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_type =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="fu">str_sub</span>(obj_seq_type,<span class="dv">4</span>,<span class="dv">9</span>), trans_type)</span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the initial combined years of data are saved as dataframes named <span class="in">`exp_1998_2022`</span> and <span class="in">`rev_1998_2022`</span>. These are then saved as exp_temp and rev_temp while recoding variables. This is BEFORE category groups are created and cleaned below. <span class="in">`exp_temp`</span> and <span class="in">`rev_temp`</span> are only temporary files; do not use for aggregating totals yet!</span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-all_obs_df, include=FALSE}</span></span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true" tabindex="-1"></a><span class="co">#include = FALSE in the chunk settings run the code but do not include the chunk in the html output</span></span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true" tabindex="-1"></a><span class="co"># remove from computer memory to free up space (in case your computer needs it)</span></span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-433"><a href="#cb15-433" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(allexpfiles22)</span>
<span id="cb15-434"><a href="#cb15-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-435"><a href="#cb15-435" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(allrevfiles22)</span>
<span id="cb15-436"><a href="#cb15-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-437"><a href="#cb15-437" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(exp_fy22)</span>
<span id="cb15-438"><a href="#cb15-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-439"><a href="#cb15-439" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(revenue_fy22)</span>
<span id="cb15-440"><a href="#cb15-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-441"><a href="#cb15-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-442"><a href="#cb15-442" aria-hidden="true" tabindex="-1"></a>Update Agencies: Some agencies have merged with others or changed names over time.</span>
<span id="cb15-443"><a href="#cb15-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-444"><a href="#cb15-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r agencies-exp}</span></span>
<span id="cb15-445"><a href="#cb15-445" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb15-446"><a href="#cb15-446" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb15-447"><a href="#cb15-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-448"><a href="#cb15-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-449"><a href="#cb15-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-450"><a href="#cb15-450" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>,</span>
<span id="cb15-451"><a href="#cb15-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb15-452"><a href="#cb15-452" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb15-453"><a href="#cb15-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-454"><a href="#cb15-454" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb15-455"><a href="#cb15-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-456"><a href="#cb15-456" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb15-457"><a href="#cb15-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-458"><a href="#cb15-458" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb15-459"><a href="#cb15-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-460"><a href="#cb15-460" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb15-461"><a href="#cb15-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-462"><a href="#cb15-462" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb15-463"><a href="#cb15-463" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency)))) </span>
<span id="cb15-464"><a href="#cb15-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-465"><a href="#cb15-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-466"><a href="#cb15-466" aria-hidden="true" tabindex="-1"></a>For aggregating revenue, use the rev_1998_2022 dataframe, join the funds_ab_in_2022 file to it, and then join the ioc_source_type file to the dataset. Remember: You need to update the funds_ab_in and ioc_source_type file every year!</span>
<span id="cb15-467"><a href="#cb15-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-470"><a href="#cb15-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-471"><a href="#cb15-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb15-472"><a href="#cb15-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-473"><a href="#cb15-473" aria-hidden="true" tabindex="-1"></a><span class="co"># fund info to revenue for all years</span></span>
<span id="cb15-474"><a href="#cb15-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-475"><a href="#cb15-475" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rev_1998_2022, funds_ab_in_2022, <span class="at">by =</span> <span class="st">"fund"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(source)</span>
<span id="cb15-476"><a href="#cb15-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-477"><a href="#cb15-477" aria-hidden="true" tabindex="-1"></a><span class="co"># need to update the ioc_source_type file every year! </span></span>
<span id="cb15-478"><a href="#cb15-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-479"><a href="#cb15-479" aria-hidden="true" tabindex="-1"></a>ioc_source_type <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"C:/Users/aleaw/OneDrive/Documents/PhD Fall 2021 - Spring 2022/Merriman RA/Fiscal Futures FY2022/Replication-Files/ioc_source_updated22_AWM.xlsx"</span>)</span>
<span id="cb15-480"><a href="#cb15-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-481"><a href="#cb15-481" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rev_temp, ioc_source_type, <span class="at">by =</span> <span class="st">"source"</span>)</span>
<span id="cb15-482"><a href="#cb15-482" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically used source, source name does not match for the join to work using source_name</span></span>
<span id="cb15-483"><a href="#cb15-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-484"><a href="#cb15-484" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb15-485"><a href="#cb15-485" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb15-486"><a href="#cb15-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-487"><a href="#cb15-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-488"><a href="#cb15-488" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>, <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb15-489"><a href="#cb15-489" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb15-490"><a href="#cb15-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-491"><a href="#cb15-491" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb15-492"><a href="#cb15-492" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb15-493"><a href="#cb15-493" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb15-494"><a href="#cb15-494" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb15-495"><a href="#cb15-495" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb15-496"><a href="#cb15-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-497"><a href="#cb15-497" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency))))</span>
<span id="cb15-498"><a href="#cb15-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-499"><a href="#cb15-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-502"><a href="#cb15-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-503"><a href="#cb15-503" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(rev_temp, <span class="at">file =</span> <span class="st">"rev_temp.csv"</span>)</span>
<span id="cb15-504"><a href="#cb15-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-505"><a href="#cb15-505" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(exp_temp, <span class="at">file =</span> <span class="st">"exp_temp.csv"</span>)</span>
<span id="cb15-506"><a href="#cb15-506" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>