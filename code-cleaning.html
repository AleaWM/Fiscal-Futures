<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Methodology for the Fiscal Futures Annual Report - 14&nbsp; Gathering and Cleaning Data!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./past-mistakes.html" rel="next">
<link href="./FundsIncluded.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Methodology for the Fiscal Futures Annual Report</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-methodology" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Methodology</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-methodology">    
        <li>
    <a class="dropdown-item" href="./FundsIncluded.html">
 <span class="dropdown-text">An All Funds Approach</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./code-cleaning.html">
 <span class="dropdown-text">Gathering and Cleaning Data!</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Everything.html">
 <span class="dropdown-text">Calculating the Fiscal Gap</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/AleaWM/Fiscal-Futures/tree/main/data"> 
<span class="menu-text">Data</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
    <a href="https://github.com/AleaWM/Fiscal-Futures/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./FundsIncluded.html">Methodology</a></li><li class="breadcrumb-item"><a href="./code-cleaning.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background Information</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Reports</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Everything.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Calculating the Fiscal Gap</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Everything_changepensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Pension Costs Included within Department Expenditures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Illinois State Budget Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./OwnSourceRev.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Own Source Revenue</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FederalRevenue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Federal Revenue</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LocalTransfers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Local Transfers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Medicaid.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Medicaid</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Debt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Debt Service Discussion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pensions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Pensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Healthcare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">State Employee Healthcare Discussion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./TaxRefunds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Tax Refunds</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./K12_Education.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">K-12 Spending &amp; ESSER Funds</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FedMoneyReceived.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Federal COVID Money Received</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Methodology</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FundsIncluded.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">An All Funds Approach</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code-cleaning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./past-mistakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Past Report Corrections</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#example-of-inspecting-new-fy22-data-files" id="toc-example-of-inspecting-new-fy22-data-files" class="nav-link active" data-scroll-target="#example-of-inspecting-new-fy22-data-files"><span class="header-section-number">14.0.1</span> Example of Inspecting new FY22 data files</a></li>
  <li><a href="#finding-new-agencies-and-funds" id="toc-finding-new-agencies-and-funds" class="nav-link" data-scroll-target="#finding-new-agencies-and-funds"><span class="header-section-number">14.0.2</span> Finding new agencies and funds</a></li>
  <li><a href="#recoding-new-and-reused-funds" id="toc-recoding-new-and-reused-funds" class="nav-link" data-scroll-target="#recoding-new-and-reused-funds"><span class="header-section-number">14.0.3</span> Recoding New and Reused Funds</a></li>
  <li><a href="#export-intermediate-files" id="toc-export-intermediate-files" class="nav-link" data-scroll-target="#export-intermediate-files"><span class="header-section-number">14.0.4</span> Export Intermediate Files</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./FundsIncluded.html">Methodology</a></li><li class="breadcrumb-item"><a href="./code-cleaning.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-gathering-and-cleaning-data" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Gathering and Cleaning Data!</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Information for the Fiscal Futures all funds database comes from detailed information provided by the Illinois Comptroller’s office.&nbsp; Currently the database includes 300,000 individual records for fiscal years 1998 to 2022.</p>
<ul>
<li>Do the FOIA request. In a week or so, they send the expenditure and revenue data as excel files.</li>
<li>Checks whether there are any new agencies, re-used funds etc. Create a list of funds, agencies, fund names, etc. for the new year and compare it to the immediate prior year to identify new funds.</li>
<li>Update the funds_ab_in file which shows the use of funds. Use criteria to determine if the new funds should be in or out of the all-funds frame.</li>
<li>Change the variable names to be consistent with other files such as AGENCYNAME –&gt; agency_name</li>
<li>Once variable names are shared over all years of data, combine past years with newest year. All revenue files are in a `revenue` folder that I reference when I set the working directory. When adding new fiscal years, put the the newest year of data for revenue and expenditures in their respective folders.</li>
</ul>
<p>Normally, when your receive the new fiscal year files from the Comptrollers office, you will need to change the variable names so that they are consistent with past years. This is an example of reading in the new file and changing the variable names. They seem to change almost every year in the file received from the FOIA so if the code breaks here, check to make sure that the columns you are trying to rename exist and are spelled correctly! Once variables are the same, you will want to save the file as a csv file in its Revenue/Expenditure file and bind all past years and the current year together in one dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Example code below: Read in excel file and rename columns so that it plays well with the other years' files.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># revenue_fy23 &lt;- read_xlsx("Fis_Fut_Rev_2023_Final.xlsx") %&gt;% </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(fy = 'FY',</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund = 'FUND',</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_name = 'FUND NAME',</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency = 'AGENCY',</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency_name = 'AGENCY NAME',</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#          source = 'REVENUE SOURCE',</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          source_name = 'REV SRC NAME',</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#          receipts = 'AMOUNT'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># exp_fy23 &lt;- read_xlsx("Fis_Fut_Exp_2023_Final.xlsx") %&gt;% </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(fy = 'FY',</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund = 'FUND',</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_name = 'FUND NAME',</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency = 'AGENCY',</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency_name = 'AGENCY NAME',</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#          appr_org = 'ORGANIZATION',</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#          org_name = 'ORGANIZATION NAME',</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#          obj_seq_type = 'APPROPRIATION',</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#          wh_approp_name = 'APPROPRIATION NAME',</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#         # exp_net_xfer = 'NET OF TRANS AMOUNT',</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          expenditure = 'EXPENDED'</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="do">## New files had different variable names!! </span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Had to update code slightly ## </span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>rev_current <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"inputs/ioc_data_received/revenue/Fis_Fut_Rev_071124.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FISCAL YEAR'</span>,</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">'REVENUE SOURCE'</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">source_name =</span> <span class="st">'REVENUE SOURCE NAME'</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">receipts =</span> <span class="st">'AMOUNT'</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">data_source =</span> <span class="st">"rev IOC 07.11.2024"</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># some variable names in the excel file received change</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># check each year during preliminary and final datasets </span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># can't bind rows unless columns match</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>exp_current <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"inputs/ioc_data_received/expenditures/Fis_Fut_Exp_111524.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FISCAL YEAR'</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">appr_org =</span> <span class="st">'ORGANIZATION'</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">org_name =</span> <span class="st">'ORGANIZATION NAME'</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">obj_seq_type =</span> <span class="st">'APPROPRIATION'</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">wh_approp_name =</span> <span class="st">'APPROPRIATION NAME'</span>,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">appn_net_xfer =</span> <span class="st">'APPROPRIATED AMT NET OF TRANSFERS'</span>,</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">expenditure =</span> <span class="st">'EXPENDED AMT'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">data_source =</span> <span class="st">"exp IOC 11.15.2024"</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, appr_org, org_name, obj_seq_type, wh_approp_name, appn_net_xfer, expenditure, data_source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below takes the .dta files for all fiscal years before FY 2022 and binds them together. Variable names were manually changed by past researchers so that they were consistent across years.</p>
<p>For FY 2023 and after, .dta files can be avoided entirely and .csv or excel files will be used. All files before this year had been saved and passed on as .dta files for Stata code before the transition to R in Fall 2022.</p>
<!--- Dug deep in the box files and found old Excel files for each year of requested data. Tried to make a new Database folder that has the excel files before manipulating but didn't finish.  --->
<p>For years after fy22: add line of code to bind csv files after binding the dta files together. Variable names must be identical to merge files together.</p>
<p>Code below reads in the csv files created in chunks above (allrevfiles.csv and allrexpfiles.csv). These files contain all years of data combined into one file BEFORE any recoding is done. Do not use this file for summing categories because it is just an inbetween step before recoding revenue and expenditure categories. It also does not contain changes in funds or agencies.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>allrevfiles_past <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, past_year, <span class="st">" Files/allrevfiles_"</span>, past_year, <span class="st">".csv"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add in excel file for current year</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>allrevfiles_current <span class="ot">&lt;-</span> allrevfiles_past <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, source, source_name, receipts, data_source) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(rev_current)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Fy21: 62294 observations, 13 variables</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#FY22: 65094 obs, 13 vars</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#FY23: 57822 obs</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#fy24: 70,492 obs</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>allexpfiles_past <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, past_year, <span class="st">" Files/allexpfiles_"</span>, past_year, <span class="st">".csv"</span>))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># add in excel file for current year</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>allexpfiles_current <span class="ot">&lt;-</span> allexpfiles_past <span class="sc">%&gt;%</span> </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, appr_org, org_name, obj_seq_type, wh_approp_name, appn_net_xfer, expenditure, data_source) <span class="sc">%&gt;%</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(exp_current)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># fy21 213372 observations, 20 variables</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fy22 225587 obs, 21 vars.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># fy23 238089 obs</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># fy24 250,411 obs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allrevfiles_current, <span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allrevfiles_"</span>, current_year, <span class="st">".csv"</span>))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allexpfiles_current, <span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allexpfiles_"</span>, current_year, <span class="st">".csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combined in past chunks called create-rev-csv and create-exp-csv</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>allrevfiles <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allrevfiles_"</span>, current_year, <span class="st">".csv"</span>) ) <span class="co">#combined but not recoded</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>allexpfiles <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allexpfiles_"</span>, current_year, <span class="st">".csv"</span>)) <span class="co">#combined but not recoded</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="example-of-inspecting-new-fy22-data-files" class="level3" data-number="14.0.1">
<h3 data-number="14.0.1" class="anchored" data-anchor-id="example-of-inspecting-new-fy22-data-files"><span class="header-section-number">14.0.1</span> Example of Inspecting new FY22 data files</h3>
<p>Data files for closed years have been obtained from IOC. The numbers of funds, agencies, organizations, and revenue sources below were found by using pivot tables in the codebook files in the FY2022 Box folder. This could also be done using R and grouping new files by fund, agency, source number, source names, etc..</p>
<p>Revenue File:</p>
<ul>
<li>684 Fund Numbers</li>
<li>80 Agencies</li>
<li>1184 Revenue source numbers</li>
<li>1156 revenue source names</li>
</ul>
<p>Expenditure File:</p>
<ul>
<li>708 Fund Numbers</li>
<li>107 Agencies</li>
<li>98 Organization Numbers</li>
<li>313 Organization names</li>
</ul>
</section>
<section id="finding-new-agencies-and-funds" class="level3" data-number="14.0.2">
<h3 data-number="14.0.2" class="anchored" data-anchor-id="finding-new-agencies-and-funds"><span class="header-section-number">14.0.2</span> Finding new agencies and funds</h3>
<p>General steps:</p>
<ol type="1">
<li>Identify new and reused funds for newest fiscal year.</li>
<li>Recode funds to take into account different fund numbers/names over the years. See [Recoding New and Reused Funds] for code chunk that does this.</li>
<li>Update <code>fund_ab_in_CURRENTFY.xlsx</code> with any changes from previous fiscal year.</li>
</ol>
<p><strong>New Agencies, Funds, and Organizations from Expenditure files:</strong></p>
<ul>
<li>Using the code below, I found 2 agencies, multiple funds, and a couple organizations that had not been specifically mentioned in the funds_ab_in file - AWM, FY2022.</li>
<li>Note: One new org name and org number combo has an expenditure of $600 million for pensions payment.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#allrevfiles &lt;- read_csv("inputs/allrevfiles.csv") #combined but not recoded</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#allexpfiles &lt;- read_csv("inputs/allexpfiles.csv") #combined but not recoded</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>cur_fy  <span class="ot">&lt;-</span> <span class="dv">2024</span>  <span class="co"># Create variable for current fiscal year to save time for updating in future years.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Expenditure Data #####</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies referenced in any year before current year:</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allexpfiles <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 148 agencies ever</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies in current year data:</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> allexpfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 280 and 533 are new agency codes from old code cleaning methodology.</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># When creating fiscal future categories for the fiscal gap, 280 is assigned to Group = 920 ( Judicial) expenditure category</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 533 was assigned to "949. Other Boards and Commissions"</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">#compare past and present</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies, agencies_past, </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allexpfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>funds <span class="ot">&lt;-</span> allexpfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># compare past and current year</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 26 funds were in FY23 data that were not in past data:</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds, funds_past, </span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fund)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Each year these must examined closely to determine if they are a new fund, a reused fund, or if there is just a slight difference in the name of the fund </span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_past for orgs in the past =  920 org groups ever</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>orgs_past <span class="ot">&lt;-</span> allexpfiles <span class="sc">%&gt;%</span> </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(appr_org <span class="sc">==</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs_past # 916 org groups ever</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>orgs <span class="ot">&lt;-</span> allexpfiles <span class="sc">%&gt;%</span> </span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">appr_org =</span> <span class="fu">as.character</span>(appr_org)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(appr_org, org_name) <span class="sc">%&gt;%</span> </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Expenditure =</span> <span class="fu">sum</span>(expenditure, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co"># orgs22 # 399 org groups this year</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co"># copare past and current year orgs</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 org number and org name combos are new for FY2023:</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Usually not a big deal, orgs are not used much in the gap calculation.</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="co"># but good to stay aware and look for any change that may be important.</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(orgs, orgs_past,</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>          <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"appr_org"</span>, <span class="st">"org_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(appr_org)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>New Revenue Funds, Sources, and New Agencies:</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### From Revenue Data ####</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># agencies_past # 108 agencies ever</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>agencies_past <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(agency <span class="sc">==</span> <span class="fu">as.character</span>(agency)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Finds 533 and 280 again. </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(agencies, agencies_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"agency"</span>, <span class="st">"agency_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(agency)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>funds_past <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>funds <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(fund <span class="sc">==</span> <span class="fu">as.character</span>(fund)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fund, fund_name) <span class="sc">%&gt;%</span>  </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 revenue funds were in FY23 revenue data that were not in past data </span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small fund name changes</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(funds, funds_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"fund"</span>, <span class="st">"fund_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fund)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>sources_past <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">&lt;</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>sources <span class="ot">&lt;-</span> allrevfiles  <span class="sc">%&gt;%</span> </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fy <span class="sc">==</span> cur_fy) <span class="sc">%&gt;%</span> </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(source <span class="sc">==</span> <span class="fu">as.character</span>(source)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(source, source_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">Receipts =</span> <span class="fu">sum</span>(receipts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 16 revenue sources were in FY23 data that were not in past data </span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="co"># some could be small source name changes:</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(sources, sources_past, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"source"</span>, <span class="st">"source_name"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="recoding-new-and-reused-funds" class="level3" data-number="14.0.3">
<h3 data-number="14.0.3" class="anchored" data-anchor-id="recoding-new-and-reused-funds"><span class="header-section-number">14.0.3</span> Recoding New and Reused Funds</h3>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Remember: <code>allrevfiles</code> and <code>allexpfiles</code> contain the data received from the comptroller without recoding agencies or funds that have changed between fiscal years. Variables were renamed when needed to have consistent names but funds and agencies have NOT been recoded for consistency in these files.</p>
</div>
</div>
<p>New or reused funds were manually added to the <code>funds_ab_in.xlsx</code> file and determined if they should or should not be included in Fiscal Future calculations.</p>
<p>For funds that were reused once, a 9 replaces the 0 as the first digit. If reused twice, then the first two values are 10.</p>
<ul>
<li>Ex. 0350 –&gt; 9350 because its use changed.</li>
<li>Ex. 0367 becomes 10367 because its use has changed twice now. There was fund 0367 originally, then its use changed and it was recoded as 9367, and now it changed again so it is a 10367.</li>
<li>Excel file also has alternative ways to name funds (e.g.&nbsp;0397-A and 0397-B) and variables for the year that the fund stopped being used.</li>
</ul>
<p>New or reused funds revenue file recoding:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9 if its purpose has changed</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>rev_allyears <span class="ot">&lt;-</span> allrevfiles <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span> (fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>   <span class="co">#2022 changes</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>, <span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2023 fund changes</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0099"</span>,<span class="st">"0210"</span>,<span class="st">"0246"</span>, <span class="st">"0250"</span>, <span class="st">"0264"</span>, <span class="st">"0268"</span>, <span class="st">"0300"</span>, <span class="st">"0311"</span>, <span class="st">"0403"</span>, <span class="st">"0448"</span>,<span class="st">"0645"</span>, <span class="st">"0727"</span>, <span class="st">"0729"</span>, <span class="st">"0791"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0734"</span> , <span class="st">"10734"</span>, <span class="fu">as.character</span>(fund)),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0820"</span>, <span class="st">"10820"</span>, <span class="fu">as.character</span>(fund) ) <span class="co"># fund reused for 3rd time</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a> <span class="co">#  other fund changes noticed on April 1, 2024</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0490"</span>, <span class="st">"0684"</span>, <span class="st">"0747"</span>, <span class="st">"0869"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund)))  <span class="sc">|&gt;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2024</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0064"</span>,<span class="st">"0162"</span>,<span class="st">"0267"</span>, <span class="st">"0349"</span>, <span class="st">"0420"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Expenditure recoding:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if first character is a 0, replace with a 9</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>exp_allyears <span class="ot">&lt;-</span> allexpfiles <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2002</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0730"</span>, <span class="st">"0241"</span>, <span class="st">"0350"</span>, <span class="st">"0367"</span>, <span class="st">"0381"</span>, <span class="st">"0382"</span>, <span class="st">"0526"</span>, <span class="st">"0603"</span>, <span class="st">"0734"</span>, <span class="st">"0913"</span>, <span class="st">"0379"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2008</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0027"</span>, <span class="st">"0033"</span>, <span class="st">"0037"</span>, <span class="st">"0058"</span>, <span class="st">"0062"</span>, <span class="st">"0066"</span>, <span class="st">"0075"</span>, <span class="st">"0083"</span>, <span class="st">"0116"</span>, <span class="st">"0119"</span>, <span class="st">"0120"</span>, <span class="st">"0122"</span>, <span class="st">"0148"</span>, <span class="st">"0149"</span>, <span class="st">"0157"</span>, <span class="st">"0158"</span>, <span class="st">"0166"</span>, <span class="st">"0194"</span>, <span class="st">"0201"</span>, <span class="st">"0209"</span>, <span class="st">"0211"</span>, <span class="st">"0217"</span>, <span class="st">"0223"</span>, <span class="st">"0231"</span>, <span class="st">"0234"</span>, <span class="st">"0253"</span>, <span class="st">"0320"</span>, <span class="st">"0503"</span>, <span class="st">"0505"</span>, <span class="st">"0512"</span>, <span class="st">"0516"</span>, <span class="st">"0531"</span>, <span class="st">"0532"</span>, <span class="st">"0533"</span>, <span class="st">"0547"</span>, <span class="st">"0563"</span>, <span class="st">"0579"</span>, <span class="st">"0591"</span>, <span class="st">"0606"</span>, <span class="st">"0616"</span>, <span class="st">"0624"</span>, <span class="st">"0659"</span>, <span class="st">"0662"</span>, <span class="st">"0665"</span>, <span class="st">"0676"</span>, <span class="st">"0710"</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">"0068"</span>, <span class="st">"0076"</span>, <span class="st">"0115"</span>, <span class="st">"0119"</span>, <span class="st">"0168"</span>, <span class="st">"0182"</span>, <span class="st">"0199"</span>, <span class="st">"0241"</span>, <span class="st">"0307"</span>, <span class="st">"0506"</span>, <span class="st">"0509"</span>, <span class="st">"0513"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2016</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0263"</span>, <span class="st">"0399"</span>, <span class="st">"0409"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2017</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0364"</span>, <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0818"</span>, <span class="st">"0767"</span>, <span class="st">"0671"</span>, <span class="st">"0593"</span>, <span class="st">"0578"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&gt;</span><span class="dv">1999</span> <span class="sc">&amp;</span> fy <span class="sc">&lt;</span> <span class="dv">2018</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0231"</span>, <span class="st">"10231"</span>, fund) ) <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2019</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0161"</span>, <span class="st">"0489"</span>, <span class="st">"0500"</span>, <span class="st">"0612"</span>, <span class="st">"0893"</span>, <span class="st">"0766"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2020</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0254"</span>, <span class="st">"0304"</span>, <span class="st">"0324"</span>, <span class="st">"0610"</span>, <span class="st">"0887"</span>, <span class="st">"0908"</span>, <span class="st">"0939"</span>, <span class="st">"0968"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund)) <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span>  <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2021</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0255"</span>, <span class="st">"0325"</span>, <span class="st">"0348"</span>, <span class="st">"0967"</span>, <span class="st">"0972"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), fund))  <span class="sc">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#2022 changes</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0110"</span>,<span class="st">"0165"</span>,<span class="st">"0351"</span>, <span class="st">"0392"</span>, <span class="st">"0393"</span>, <span class="st">"0422"</span>, <span class="st">"0544"</span>, <span class="st">"0628"</span>, <span class="st">"0634"</span>,  <span class="st">"0656"</span>, <span class="st">"0672"</span>, <span class="st">"0683"</span>,<span class="st">"0723"</span>, <span class="st">"0742"</span>, <span class="st">"0743"</span>), <span class="fu">str_replace</span>(fund, <span class="st">"0"</span>,<span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span>  <span class="co"># replaces first 0 it finds with a 9</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2022</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0367"</span>, <span class="st">"10367"</span>, <span class="fu">as.character</span>(fund)) <span class="co"># fund reused for 3rd time </span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2023 fund changes</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0099"</span>,<span class="st">"0210"</span>,<span class="st">"0246"</span>, <span class="st">"0250"</span>, <span class="st">"0264"</span>, <span class="st">"0268"</span>, <span class="st">"0300"</span>, <span class="st">"0311"</span>, <span class="st">"0403"</span>, <span class="st">"0448"</span>,<span class="st">"0645"</span>, <span class="st">"0727"</span>, <span class="st">"0729"</span>, <span class="st">"0791"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund))) <span class="sc">%&gt;%</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0734"</span> , <span class="st">"10734"</span>, <span class="fu">as.character</span>(fund)),</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="fu">ifelse</span>(fy<span class="sc">&lt;</span><span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0820"</span>, <span class="st">"10820"</span>, <span class="fu">as.character</span>(fund) ) <span class="co"># fund reused for 3rd time</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a> <span class="co">#  other fund changes noticed on April 1, 2024</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2023</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0490"</span>, <span class="st">"0684"</span>, <span class="st">"0747"</span>, <span class="st">"0869"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund)))  <span class="sc">|&gt;</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">fund =</span> <span class="fu">ifelse</span>(fy <span class="sc">&lt;</span> <span class="dv">2024</span> <span class="sc">&amp;</span> fund <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"0064"</span>,<span class="st">"0162"</span>,<span class="st">"0267"</span>, <span class="st">"0349"</span>, <span class="st">"0420"</span>), <span class="fu">str_replace</span>(fund,<span class="st">"0"</span>, <span class="st">"9"</span>), <span class="fu">as.character</span>(fund)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>funds_ab_in.xlsx</code> file contains the following information: all funds that have existed since 1998, if they still exist, indicates if fund numbers have been reused for varying purposes, and is updated yearly with new fund numbers used by the IOC.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>agencies_exp <span class="ot">&lt;-</span> exp_allyears <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(agency, agency_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(agency_name)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">as.character</span>(agency))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>funds_exp <span class="ot">&lt;-</span> exp_allyears <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(fund, fund_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fund_name))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>funds_ab_in <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"inputs/funds_ab_in.xlsx"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_allyears <span class="sc">%&gt;%</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fund_name) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(fund, fy)  <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># join  funds_ab_in  to exp_temp</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(funds_ab_in, <span class="at">by =</span> <span class="st">"fund"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Agency == 799 for Statutory transfers </span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  Object == 1993 is for Interfund cash transfers  </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">transfer =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_agency =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">str_sub</span>(obj_seq_type,<span class="dv">1</span>,<span class="dv">3</span>), <span class="cn">NA</span>),</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">trans_type =</span> <span class="fu">ifelse</span>(org_name <span class="sc">==</span> <span class="st">"TRANSFERS"</span>, </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">str_sub</span>(obj_seq_type, <span class="dv">4</span>,<span class="dv">9</span>), <span class="cn">NA</span>)) <span class="sc">%&gt;%</span>   </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">object =</span> <span class="fu">ifelse</span>(transfer <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">as.character</span>(<span class="fu">str_sub</span>(obj_seq_type, <span class="dv">1</span>, <span class="dv">4</span>)), <span class="cn">NA_character_</span>),  <span class="co"># appropriation object</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">sequence =</span> <span class="fu">ifelse</span>(transfer <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">as.character</span>(<span class="fu">str_sub</span>(obj_seq_type, <span class="dv">5</span>,<span class="dv">6</span>)), <span class="cn">NA_character_</span>),</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">ifelse</span>(transfer <span class="sc">==</span> <span class="dv">0</span>, <span class="fu">str_sub</span>(obj_seq_type, <span class="dv">7</span>,<span class="dv">8</span>), <span class="cn">NA_character_</span>)    <span class="co"># appropriation type</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>the initial combined and years of data are saved as dataframes named <code>exp_allyears</code> and <code>rev_allyears</code>. These are then saved as exp_temp and rev_temp while recoding variables. This is BEFORE creating Fiscal Future category groups and further data cleaning done in the Calculating the Fiscal Gap page.</li>
</ul>
<p>Update Agencies: Some agencies have merged with others or changed names over time.</p>
<p><strong>[[ TO DO: Add appendix item of Current agencies (with indented past agencies) from the Methodology Document. ]]</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>exp_temp <span class="ot">&lt;-</span> exp_temp <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency)))) </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># exp_temp &lt;- exp_temp %&gt;% filter(!is.na(fy))</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Fill in missing names for funds</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># exp_temp &lt;- exp_temp  %&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-c(agency_name)) %&gt;%</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(funds_exp) %&gt;%</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(agencies_exp)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For aggregating revenue, use the <code>rev_allyears</code> file, join the <code>funds_ab_in</code> file to it, and then join the <code>ioc_source_type</code> file. Remember: You need to update the <code>funds_ab_in</code> and <code>ioc_source_type</code> file every year!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rev_allyears, funds_ab_in, <span class="at">by =</span> <span class="st">"fund"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(source) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>funds_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(fund, fund_name_ab) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fund_name_ab))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>agencies_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(agency, agency_name) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(agency_name)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">as.character</span>(agency))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># need to update the ioc_source_type file every year! </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>ioc_source_type <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"./inputs/ioc_source.xlsx"</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rev_temp, ioc_source_type, <span class="at">by =</span> <span class="st">"source"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>sources_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(source, source_name_AWM) <span class="sc">%&gt;%</span> </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(source_name_AWM))</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fund info to revenue for all years</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(fund_name, agency_name, </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            source_name_AWM))  <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(funds_rev) <span class="sc">%&gt;%</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sources_rev)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically used source, source name does not match for the join to work using source_name</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>, <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency)))) <span class="sc">%&gt;%</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">#left_join(sources_rev) %&gt;%</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(agencies_rev) <span class="co"># add correct agency names back in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="export-intermediate-files" class="level3" data-number="14.0.4">
<h3 data-number="14.0.4" class="anchored" data-anchor-id="export-intermediate-files"><span class="header-section-number">14.0.4</span> Export Intermediate Files</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(rev_temp, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"./data/FY"</span>, current_year, <span class="st">" Files/rev_temp.csv"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(exp_temp, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"./data/FY"</span>, current_year, <span class="st">" Files/exp_temp.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>exp_temp.csv</code> file and <code>rev_temp.csv</code> file are most likely the data that non-Fiscal Future researchers would want to use for their own analyses. These files should have consistent agencies and funds tracked from 1998 to the present.</p>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./FundsIncluded.html" class="pagination-link" aria-label="An All Funds Approach">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">An All Funds Approach</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./past-mistakes.html" class="pagination-link" aria-label="Past Report Corrections">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Past Report Corrections</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Gathering and Cleaning Data! {#sec-gathering-and-cleaning-data}</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, warning = FALSE, message=FALSE}</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="in">#| include: false</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="in">library(readxl)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="in">current_year &lt;- 2024</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="in">past_year &lt;- current_year - 1</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(warning = FALSE, message = FALSE, eval=FALSE)</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>Information for the Fiscal Futures all funds database comes from detailed information provided by the Illinois Comptroller's office.&nbsp; Currently the database includes 300,000 individual records for fiscal years 1998 to 2022.</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do the FOIA request. In a week or so, they send the expenditure and revenue data as excel files.</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Checks whether there are any new agencies, re-used funds etc. Create a list of funds, agencies, fund names, etc. for the new year and compare it to the immediate prior year to identify new funds.</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Update the funds_ab_in file which shows the use of funds. Use criteria to determine if the new funds should be in or out of the all-funds frame.</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Change the variable names to be consistent with other files such as AGENCYNAME --<span class="sc">\&gt;</span> agency_name</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Once variable names are shared over all years of data, combine past years with newest year. All revenue files are in a <span class="sc">\`</span>revenue<span class="sc">\`</span> folder that I reference when I set the working directory. When adding new fiscal years, put the the newest year of data for revenue and expenditures in their respective folders.</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>Normally, when your receive the new fiscal year files from the Comptrollers office, you will need to change the variable names so that they are consistent with past years. This is an example of reading in the new file and changing the variable names. They seem to change almost every year in the file received from the FOIA so if the code breaks here, check to make sure that the columns you are trying to rename exist and are spelled correctly! Once variables are the same, you will want to save the file as a csv file in its Revenue/Expenditure file and bind all past years and the current year together in one dataframe.</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Example code below: Read in excel file and rename columns so that it plays well with the other years' files.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># revenue_fy23 &lt;- read_xlsx("Fis_Fut_Rev_2023_Final.xlsx") %&gt;% </span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(fy = 'FY',</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund = 'FUND',</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_name = 'FUND NAME',</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency = 'AGENCY',</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency_name = 'AGENCY NAME',</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co">#          source = 'REVENUE SOURCE',</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co">#          source_name = 'REV SRC NAME',</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co">#          receipts = 'AMOUNT'</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co"># exp_fy23 &lt;- read_xlsx("Fis_Fut_Exp_2023_Final.xlsx") %&gt;% </span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(fy = 'FY',</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund = 'FUND',</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co">#          fund_name = 'FUND NAME',</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency = 'AGENCY',</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="co">#          agency_name = 'AGENCY NAME',</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co">#          appr_org = 'ORGANIZATION',</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co">#          org_name = 'ORGANIZATION NAME',</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="co">#          obj_seq_type = 'APPROPRIATION',</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co">#          wh_approp_name = 'APPROPRIATION NAME',</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co">#         # exp_net_xfer = 'NET OF TRANS AMOUNT',</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="co">#          expenditure = 'EXPENDED'</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) </span></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="do">## New files had different variable names!! </span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="do">## Had to update code slightly ## </span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>rev_current <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"inputs/ioc_data_received/revenue/Fis_Fut_Rev_071124.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FISCAL YEAR'</span>,</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">'REVENUE SOURCE'</span>,</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">source_name =</span> <span class="st">'REVENUE SOURCE NAME'</span>,</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">receipts =</span> <span class="st">'AMOUNT'</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">data_source =</span> <span class="st">"rev IOC 07.11.2024"</span>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co"># some variable names in the excel file received change</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a><span class="co"># check each year during preliminary and final datasets </span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co"># can't bind rows unless columns match</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>exp_current <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"inputs/ioc_data_received/expenditures/Fis_Fut_Exp_111524.xlsx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">fy =</span> <span class="st">'FISCAL YEAR'</span>,</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund =</span> <span class="st">'FUND'</span>,</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">fund_name =</span> <span class="st">'FUND NAME'</span>,</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency =</span> <span class="st">'AGENCY'</span>,</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>         <span class="at">agency_name =</span> <span class="st">'AGENCY NAME'</span>,</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>         <span class="at">appr_org =</span> <span class="st">'ORGANIZATION'</span>,</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>         <span class="at">org_name =</span> <span class="st">'ORGANIZATION NAME'</span>,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>         <span class="at">obj_seq_type =</span> <span class="st">'APPROPRIATION'</span>,</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>         <span class="at">wh_approp_name =</span> <span class="st">'APPROPRIATION NAME'</span>,</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">appn_net_xfer =</span> <span class="st">'APPROPRIATED AMT NET OF TRANSFERS'</span>,</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">expenditure =</span> <span class="st">'EXPENDED AMT'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">data_source =</span> <span class="st">"exp IOC 11.15.2024"</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, appr_org, org_name, obj_seq_type, wh_approp_name, appn_net_xfer, expenditure, data_source)</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>The code chunk below takes the .dta files for all fiscal years before FY 2022 and binds them together. Variable names were manually changed by past researchers so that they were consistent across years.</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>For FY 2023 and after, .dta files can be avoided entirely and .csv or excel files will be used. All files before this year had been saved and passed on as .dta files for Stata code before the transition to R in Fall 2022.</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--- Dug deep in the box files and found old Excel files for each year of requested data. Tried to make a new Database folder that has the excel files before manipulating but didn't finish.  ---&gt;</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>For years after fy22: add line of code to bind csv files after binding the dta files together. Variable names must be identical to merge files together.</span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-rev-csv-FY23, include=FALSE, eval=FALSE}</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a><span class="in"># original way of combing dta files.</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a><span class="in"># now each year just takes the previous years combined file and row binds the newest data to it instead of recreating it</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a><span class="in"># years after fy22: add line of code to bind csv files after binding the dta files.</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a><span class="in">setwd("./inputs/ioc_data_received/revenue")</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a><span class="in">allrevfiles22 = list.files(path = "./inputs/ioc_data_received/revenue",  pattern = ".dta") %&gt;%  </span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(read_dta) %&gt;% bind_rows</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a><span class="in">#Fy21: 62294 observations, 13 variables</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a><span class="in">#FY22: 65094 obs, 13 vars</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a><span class="in">write_csv(allrevfiles23, "./data/FY2022 Files/allrevfiles22.csv")</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a><span class="in">setwd("./inputs/ioc_data_received/expenditures")</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a><span class="in">allexpfiles22 = list.files(path = "./inputs/ioc_data_received/expenditures",  pattern = ".dta") %&gt;%  </span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a><span class="in">  lapply(read_dta) %&gt;% bind_rows</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a><span class="in">#fy21 213372 observations, 20 variables</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a><span class="in"># fy22 225587 obs, 21 vars.</span></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a><span class="in">write_csv(allexpfiles22, ".data/FY2022 Files/allexpfiles22.csv")</span></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>Code below reads in the csv files created in chunks above (allrevfiles.csv and allrexpfiles.csv). These files contain all years of data combined into one file BEFORE any recoding is done. Do not use this file for summing categories because it is just an inbetween step before recoding revenue and expenditure categories. It also does not contain changes in funds or agencies.</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>allrevfiles_past <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, past_year, <span class="st">" Files/allrevfiles_"</span>, past_year, <span class="st">".csv"</span>))</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a><span class="co"># add in excel file for current year</span></span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>allrevfiles_current <span class="ot">&lt;-</span> allrevfiles_past <span class="sc">%&gt;%</span> </span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, source, source_name, receipts, data_source) <span class="sc">%&gt;%</span> </span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(rev_current)</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a><span class="co">#Fy21: 62294 observations, 13 variables</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a><span class="co">#FY22: 65094 obs, 13 vars</span></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="co">#FY23: 57822 obs</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="co">#fy24: 70,492 obs</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>allexpfiles_past <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(<span class="st">"data/FY"</span>, past_year, <span class="st">" Files/allexpfiles_"</span>, past_year, <span class="st">".csv"</span>))</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a><span class="co"># add in excel file for current year</span></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>allexpfiles_current <span class="ot">&lt;-</span> allexpfiles_past <span class="sc">%&gt;%</span> </span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fy, fund, fund_name, agency, agency_name, appr_org, org_name, obj_seq_type, wh_approp_name, appn_net_xfer, expenditure, data_source) <span class="sc">%&gt;%</span> </span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(exp_current)</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="co"># fy21 213372 observations, 20 variables</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a><span class="co"># fy22 225587 obs, 21 vars.</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a><span class="co"># fy23 238089 obs</span></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="co"># fy24 250,411 obs</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allrevfiles_current, <span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allrevfiles_"</span>, current_year, <span class="st">".csv"</span>))</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(allexpfiles_current, <span class="fu">paste0</span>(<span class="st">"data/FY"</span>, current_year, <span class="st">" Files/allexpfiles_"</span>, current_year, <span class="st">".csv"</span>))</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r readCSVs, warning=FALSE, message=FALSE}</span></span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a><span class="in"># combined in past chunks called create-rev-csv and create-exp-csv</span></span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a><span class="in">allrevfiles &lt;- read_csv(paste0("data/FY", current_year, " Files/allrevfiles_", current_year, ".csv") ) #combined but not recoded</span></span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a><span class="in">allexpfiles &lt;- read_csv(paste0("data/FY", current_year, " Files/allexpfiles_", current_year, ".csv")) #combined but not recoded</span></span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example of Inspecting new FY22 data files</span></span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>Data files for closed years have been obtained from IOC. The numbers of funds, agencies, organizations, and revenue sources below were found by using pivot tables in the codebook files in the FY2022 Box folder. This could also be done using R and grouping new files by fund, agency, source number, source names, etc..</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>Revenue File:</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>684 Fund Numbers</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>80 Agencies</span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1184 Revenue source numbers</span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>1156 revenue source names</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>Expenditure File:</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>708 Fund Numbers</span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>107 Agencies</span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>98 Organization Numbers</span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>313 Organization names</span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Finding new agencies and funds</span></span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a>General steps:</span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Identify new and reused funds for newest fiscal year.</span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Recode funds to take into account different fund numbers/names over the years. See <span class="sc">\[</span>Recoding New and Reused Funds<span class="sc">\]</span> for code chunk that does this.</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Update <span class="in">`fund_ab_in_CURRENTFY.xlsx`</span> with any changes from previous fiscal year.</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a>**New Agencies, Funds, and Organizations from Expenditure files:**</span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using the code below, I found 2 agencies, multiple funds, and a couple organizations that had not been specifically mentioned in the funds_ab_in file - AWM, FY2022.</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note: One new org name and org number combo has an expenditure of \$600 million for pensions payment.</span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a><span class="in">#allrevfiles &lt;- read_csv("inputs/allrevfiles.csv") #combined but not recoded</span></span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a><span class="in">#allexpfiles &lt;- read_csv("inputs/allexpfiles.csv") #combined but not recoded</span></span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a><span class="in">cur_fy  &lt;- 2024  # Create variable for current fiscal year to save time for updating in future years.</span></span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a><span class="in">#### From Expenditure Data #####</span></span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a><span class="in"># agencies referenced in any year before current year:</span></span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a><span class="in">agencies_past &lt;- allexpfiles %&gt;% </span></span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency == as.character(agency)) %&gt;% </span></span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(agency, agency_name) %&gt;% unique() %&gt;% </span></span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(expenditure = sum(expenditure, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na() %&gt;% </span></span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(agency)</span></span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a><span class="in"># agencies_past # 148 agencies ever</span></span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a><span class="in"># agencies in current year data:</span></span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a><span class="in">agencies &lt;- allexpfiles  %&gt;% </span></span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency == as.character(agency)) %&gt;% </span></span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(agency, agency_name) %&gt;% </span></span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(expenditure = sum(expenditure, na.rm = TRUE))</span></span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a><span class="in"># 280 and 533 are new agency codes from old code cleaning methodology.</span></span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a><span class="in"># When creating fiscal future categories for the fiscal gap, 280 is assigned to Group = 920 ( Judicial) expenditure category</span></span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a><span class="in"># 533 was assigned to "949. Other Boards and Commissions"</span></span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a><span class="in">#compare past and present</span></span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(agencies, agencies_past, </span></span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a><span class="in">          by = c("agency", "agency_name")) %&gt;% </span></span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(agency)</span></span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a><span class="in">funds_past &lt;- allexpfiles  %&gt;% </span></span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund == as.character(fund)) %&gt;% </span></span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fund, fund_name) %&gt;% </span></span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Expenditure = sum(expenditure, na.rm = TRUE))  %&gt;% </span></span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a><span class="in">funds &lt;- allexpfiles  %&gt;% </span></span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund == as.character(fund)) %&gt;% </span></span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fund, fund_name) %&gt;%  </span></span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Expenditure = sum(expenditure, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a><span class="in">  unique()</span></span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a><span class="in"># compare past and current year</span></span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a><span class="in"># 26 funds were in FY23 data that were not in past data:</span></span>
<span id="cb12-274"><a href="#cb12-274" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(funds, funds_past, </span></span>
<span id="cb12-275"><a href="#cb12-275" aria-hidden="true" tabindex="-1"></a><span class="in">          by = c("fund", "fund_name")) %&gt;% </span></span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(fund)</span></span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a><span class="in"># Each year these must examined closely to determine if they are a new fund, a reused fund, or if there is just a slight difference in the name of the fund </span></span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a><span class="in"># orgs_past for orgs in the past =  920 org groups ever</span></span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a><span class="in">orgs_past &lt;- allexpfiles %&gt;% </span></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(appr_org == as.character(appr_org)) %&gt;% </span></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(appr_org, org_name) %&gt;% unique() %&gt;% </span></span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(Expenditure = sum(expenditure, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a><span class="in"># orgs_past # 916 org groups ever</span></span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a><span class="in">orgs &lt;- allexpfiles %&gt;% </span></span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(appr_org = as.character(appr_org)) %&gt;% </span></span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(appr_org, org_name) %&gt;% </span></span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(Expenditure = sum(expenditure, na.rm = TRUE))</span></span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a><span class="in"># orgs22 # 399 org groups this year</span></span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a><span class="in"># copare past and current year orgs</span></span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a><span class="in"># 3 org number and org name combos are new for FY2023:</span></span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a><span class="in"># Usually not a big deal, orgs are not used much in the gap calculation.</span></span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a><span class="in"># but good to stay aware and look for any change that may be important.</span></span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(orgs, orgs_past,</span></span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a><span class="in">          by = c("appr_org", "org_name")) %&gt;% </span></span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(appr_org)</span></span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a>**New Revenue Funds, Sources, and New Agencies:**</span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a><span class="in">#### From Revenue Data ####</span></span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a><span class="in"># agencies_past # 108 agencies ever</span></span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a><span class="in">agencies_past &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency == as.character(agency)) %&gt;% </span></span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(agency, agency_name) %&gt;% unique() %&gt;% </span></span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(Receipts = sum(receipts, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a><span class="in">agencies &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency == as.character(agency)) %&gt;% </span></span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(agency, agency_name) %&gt;% </span></span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(Receipts = sum(receipts, na.rm = TRUE))</span></span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a><span class="in"># Finds 533 and 280 again. </span></span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(agencies, agencies_past, by = c("agency", "agency_name")) %&gt;% </span></span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(agency)</span></span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a><span class="in">funds_past &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund == as.character(fund)) %&gt;% </span></span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fund, fund_name) %&gt;% </span></span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Receipts = sum(receipts, na.rm = TRUE))  %&gt;% </span></span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a><span class="in">funds &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund == as.character(fund)) %&gt;% </span></span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(fund, fund_name) %&gt;%  </span></span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Receipts = sum(receipts, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a><span class="in">  unique() %&gt;% </span></span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-348"><a href="#cb12-348" aria-hidden="true" tabindex="-1"></a><span class="in"># 13 revenue funds were in FY23 revenue data that were not in past data </span></span>
<span id="cb12-349"><a href="#cb12-349" aria-hidden="true" tabindex="-1"></a><span class="in"># some could be small fund name changes</span></span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(funds, funds_past, by = c("fund", "fund_name")) %&gt;% </span></span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(fund)</span></span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a><span class="in">sources_past &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy &lt; cur_fy) %&gt;% </span></span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(source == as.character(source)) %&gt;% </span></span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(source, source_name) %&gt;% </span></span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Receipts = sum(receipts, na.rm = TRUE))  %&gt;% </span></span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a><span class="in">  drop_na()</span></span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a><span class="in">sources &lt;- allrevfiles  %&gt;% </span></span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(fy == cur_fy) %&gt;% </span></span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(source == as.character(source)) %&gt;% </span></span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(source, source_name) %&gt;% </span></span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a><span class="in">  summarize(count = n(), Receipts = sum(receipts, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a><span class="in">  unique()</span></span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a><span class="in"># 16 revenue sources were in FY23 data that were not in past data </span></span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a><span class="in"># some could be small source name changes:</span></span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a><span class="in">anti_join(sources, sources_past, by = c("source", "source_name")) %&gt;% </span></span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(source)</span></span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a><span class="fu">### Recoding New and Reused Funds</span></span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning icon="false"}</span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a>Remember: <span class="in">`allrevfiles`</span> and <span class="in">`allexpfiles`</span> contain the data received from the comptroller without recoding agencies or funds that have changed between fiscal years. Variables were renamed when needed to have consistent names but funds and agencies have NOT been recoded for consistency in these files.</span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a>New or reused funds were manually added to the <span class="in">`funds_ab_in.xlsx`</span> file and determined if they should or should not be included in Fiscal Future calculations.</span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a>For funds that were reused once, a 9 replaces the 0 as the first digit. If reused twice, then the first two values are 10.</span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ex. 0350 --<span class="sc">\&gt;</span> 9350 because its use changed.</span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ex. 0367 becomes 10367 because its use has changed twice now. There was fund 0367 originally, then its use changed and it was recoded as 9367, and now it changed again so it is a 10367.</span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Excel file also has alternative ways to name funds (e.g. 0397-A and 0397-B) and variables for the year that the fund stopped being used.</span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a>New or reused funds revenue file recoding:</span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recode-rev-funds}</span></span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: false</span></span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a><span class="in"># if first character is a 0, replace with a 9 if its purpose has changed</span></span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a><span class="in">rev_allyears &lt;- allrevfiles %&gt;%</span></span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(fund = ifelse(fy &lt; 2002 &amp; fund %in% c("0730", "0241", "0350", "0367", "0381", "0382", "0526", "0603", "0734", "0913", "0379"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse (fy &lt; 2008 &amp; fund %in% c("0027", "0033", "0037", "0058", "0062", "0066", "0075", "0083", "0116", "0119", "0120", "0122", "0148", "0149", "0157", "0158", "0166", "0194", "0201", "0209", "0211", "0217", "0223", "0231", "0234", "0253", "0320", "0503", "0505", "0512", "0516", "0531", "0532", "0533", "0547", "0563", "0579", "0591", "0606", "0616", "0624", "0659", "0662", "0665", "0676", "0710", </span></span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a><span class="in">"0068", "0076", "0115", "0119", "0168", "0182", "0199", "0241", "0307", "0506", "0509", "0513"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-405"><a href="#cb12-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-406"><a href="#cb12-406" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2016 &amp; fund %in% c("0263", "0399", "0409"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2017 &amp; fund == "0364", str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2018 &amp; fund %in% c("0818", "0767", "0671", "0593", "0578"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy&gt;1999 &amp; fy &lt; 2018 &amp; fund == "0231", "10231", fund) ) %&gt;%</span></span>
<span id="cb12-414"><a href="#cb12-414" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-415"><a href="#cb12-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-416"><a href="#cb12-416" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2019 &amp; fund %in% c("0161", "0489", "0500", "0612", "0893", "0766"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-417"><a href="#cb12-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-418"><a href="#cb12-418" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2020 &amp; fund %in% c("0254", "0304", "0324", "0610", "0887", "0908", "0939", "0968"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-419"><a href="#cb12-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-420"><a href="#cb12-420" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2021 &amp; fund %in% c("0255", "0325", "0348", "0967", "0972"), str_replace(fund, "0","9"), fund) ) %&gt;%</span></span>
<span id="cb12-421"><a href="#cb12-421" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-422"><a href="#cb12-422" aria-hidden="true" tabindex="-1"></a><span class="in">   #2022 changes</span></span>
<span id="cb12-423"><a href="#cb12-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-424"><a href="#cb12-424" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2022 &amp; fund %in% c("0110","0165","0351", "0392", "0393", "0422", "0544", "0628", "0634",  "0656", "0672", "0683", "0723", "0742", "0743"), str_replace(fund, "0","9"), as.character(fund))) %&gt;%  # replaces first 0 it finds with a 9</span></span>
<span id="cb12-425"><a href="#cb12-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-426"><a href="#cb12-426" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2022 &amp; fund == "0367", "10367", as.character(fund)) # fund reused for 3rd time</span></span>
<span id="cb12-427"><a href="#cb12-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-428"><a href="#cb12-428" aria-hidden="true" tabindex="-1"></a><span class="in">) %&gt;%</span></span>
<span id="cb12-429"><a href="#cb12-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-430"><a href="#cb12-430" aria-hidden="true" tabindex="-1"></a><span class="in">  # 2023 fund changes</span></span>
<span id="cb12-431"><a href="#cb12-431" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund %in% c("0099","0210","0246", "0250", "0264", "0268", "0300", "0311", "0403", "0448","0645", "0727", "0729", "0791"), str_replace(fund,"0", "9"), as.character(fund))) %&gt;%</span></span>
<span id="cb12-432"><a href="#cb12-432" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund == "0734" , "10734", as.character(fund)),</span></span>
<span id="cb12-433"><a href="#cb12-433" aria-hidden="true" tabindex="-1"></a><span class="in">         fund = ifelse(fy &lt; 2023 &amp; fund == "0820", "10820", as.character(fund) ) # fund reused for 3rd time</span></span>
<span id="cb12-434"><a href="#cb12-434" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb12-435"><a href="#cb12-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-436"><a href="#cb12-436" aria-hidden="true" tabindex="-1"></a><span class="in"> #  other fund changes noticed on April 1, 2024</span></span>
<span id="cb12-437"><a href="#cb12-437" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund %in% c("0490", "0684", "0747", "0869"), str_replace(fund,"0", "9"), as.character(fund)))  |&gt;</span></span>
<span id="cb12-438"><a href="#cb12-438" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-439"><a href="#cb12-439" aria-hidden="true" tabindex="-1"></a><span class="in">   mutate(fund = ifelse(fy &lt; 2024 &amp; fund %in% c("0064","0162","0267", "0349", "0420"), str_replace(fund,"0", "9"), as.character(fund)))</span></span>
<span id="cb12-440"><a href="#cb12-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-441"><a href="#cb12-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-442"><a href="#cb12-442" aria-hidden="true" tabindex="-1"></a>Expenditure recoding:</span>
<span id="cb12-443"><a href="#cb12-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-444"><a href="#cb12-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r recode-exp-funds}</span></span>
<span id="cb12-445"><a href="#cb12-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-446"><a href="#cb12-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-447"><a href="#cb12-447" aria-hidden="true" tabindex="-1"></a><span class="in"># if first character is a 0, replace with a 9</span></span>
<span id="cb12-448"><a href="#cb12-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-449"><a href="#cb12-449" aria-hidden="true" tabindex="-1"></a><span class="in">exp_allyears &lt;- allexpfiles %&gt;%</span></span>
<span id="cb12-450"><a href="#cb12-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-451"><a href="#cb12-451" aria-hidden="true" tabindex="-1"></a><span class="in">      mutate(fund = ifelse(fy &lt; 2002 &amp; fund %in% c("0730", "0241", "0350", "0367", "0381", "0382", "0526", "0603", "0734", "0913", "0379"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-452"><a href="#cb12-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-453"><a href="#cb12-453" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2008 &amp; fund %in% c("0027", "0033", "0037", "0058", "0062", "0066", "0075", "0083", "0116", "0119", "0120", "0122", "0148", "0149", "0157", "0158", "0166", "0194", "0201", "0209", "0211", "0217", "0223", "0231", "0234", "0253", "0320", "0503", "0505", "0512", "0516", "0531", "0532", "0533", "0547", "0563", "0579", "0591", "0606", "0616", "0624", "0659", "0662", "0665", "0676", "0710", </span></span>
<span id="cb12-454"><a href="#cb12-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-455"><a href="#cb12-455" aria-hidden="true" tabindex="-1"></a><span class="in">"0068", "0076", "0115", "0119", "0168", "0182", "0199", "0241", "0307", "0506", "0509", "0513"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-456"><a href="#cb12-456" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-457"><a href="#cb12-457" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2016 &amp; fund %in% c("0263", "0399", "0409"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-458"><a href="#cb12-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-459"><a href="#cb12-459" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2017 &amp; fund == "0364", str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-460"><a href="#cb12-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-461"><a href="#cb12-461" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2018 &amp; fund %in% c("0818", "0767", "0671", "0593", "0578"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-462"><a href="#cb12-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-463"><a href="#cb12-463" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy&gt;1999 &amp; fy &lt; 2018 &amp; fund == "0231", "10231", fund) ) %&gt;%</span></span>
<span id="cb12-464"><a href="#cb12-464" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-465"><a href="#cb12-465" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2019 &amp; fund %in% c("0161", "0489", "0500", "0612", "0893", "0766"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-466"><a href="#cb12-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-467"><a href="#cb12-467" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2020 &amp; fund %in% c("0254", "0304", "0324", "0610", "0887", "0908", "0939", "0968"), str_replace(fund, "0","9"), fund)) %&gt;%</span></span>
<span id="cb12-468"><a href="#cb12-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-469"><a href="#cb12-469" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund =  ifelse(fy &lt; 2021 &amp; fund %in% c("0255", "0325", "0348", "0967", "0972"), str_replace(fund, "0","9"), fund))  %&gt;%</span></span>
<span id="cb12-470"><a href="#cb12-470" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-471"><a href="#cb12-471" aria-hidden="true" tabindex="-1"></a><span class="in">  #2022 changes</span></span>
<span id="cb12-472"><a href="#cb12-472" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2022 &amp; fund %in% c("0110","0165","0351", "0392", "0393", "0422", "0544", "0628", "0634",  "0656", "0672", "0683","0723", "0742", "0743"), str_replace(fund, "0","9"), as.character(fund))) %&gt;%  # replaces first 0 it finds with a 9</span></span>
<span id="cb12-473"><a href="#cb12-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-474"><a href="#cb12-474" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2022 &amp; fund == "0367", "10367", as.character(fund)) # fund reused for 3rd time </span></span>
<span id="cb12-475"><a href="#cb12-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-476"><a href="#cb12-476" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb12-477"><a href="#cb12-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-478"><a href="#cb12-478" aria-hidden="true" tabindex="-1"></a><span class="in">  # 2023 fund changes</span></span>
<span id="cb12-479"><a href="#cb12-479" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund %in% c("0099","0210","0246", "0250", "0264", "0268", "0300", "0311", "0403", "0448","0645", "0727", "0729", "0791"), str_replace(fund,"0", "9"), as.character(fund))) %&gt;%</span></span>
<span id="cb12-480"><a href="#cb12-480" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund == "0734" , "10734", as.character(fund)),</span></span>
<span id="cb12-481"><a href="#cb12-481" aria-hidden="true" tabindex="-1"></a><span class="in">         fund = ifelse(fy&lt;2023 &amp; fund == "0820", "10820", as.character(fund) ) # fund reused for 3rd time</span></span>
<span id="cb12-482"><a href="#cb12-482" aria-hidden="true" tabindex="-1"></a><span class="in">  ) %&gt;%</span></span>
<span id="cb12-483"><a href="#cb12-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-484"><a href="#cb12-484" aria-hidden="true" tabindex="-1"></a><span class="in"> #  other fund changes noticed on April 1, 2024</span></span>
<span id="cb12-485"><a href="#cb12-485" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(fund = ifelse(fy &lt; 2023 &amp; fund %in% c("0490", "0684", "0747", "0869"), str_replace(fund,"0", "9"), as.character(fund)))  |&gt;</span></span>
<span id="cb12-486"><a href="#cb12-486" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-487"><a href="#cb12-487" aria-hidden="true" tabindex="-1"></a><span class="in">   mutate(fund = ifelse(fy &lt; 2024 &amp; fund %in% c("0064","0162","0267", "0349", "0420"), str_replace(fund,"0", "9"), as.character(fund)))</span></span>
<span id="cb12-488"><a href="#cb12-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-489"><a href="#cb12-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-490"><a href="#cb12-490" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb12-491"><a href="#cb12-491" aria-hidden="true" tabindex="-1"></a>The <span class="in">`funds_ab_in.xlsx`</span> file contains the following information: all funds that have existed since 1998, if they still exist, indicates if fund numbers have been reused for varying purposes, and is updated yearly with new fund numbers used by the IOC.</span>
<span id="cb12-492"><a href="#cb12-492" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb12-493"><a href="#cb12-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-494"><a href="#cb12-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r create-exp_temp}</span></span>
<span id="cb12-495"><a href="#cb12-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-496"><a href="#cb12-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-497"><a href="#cb12-497" aria-hidden="true" tabindex="-1"></a><span class="in">agencies_exp &lt;- exp_allyears %&gt;% </span></span>
<span id="cb12-498"><a href="#cb12-498" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(agency, agency_name) %&gt;% </span></span>
<span id="cb12-499"><a href="#cb12-499" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(agency_name)) %&gt;%</span></span>
<span id="cb12-500"><a href="#cb12-500" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency = as.character(agency))</span></span>
<span id="cb12-501"><a href="#cb12-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-502"><a href="#cb12-502" aria-hidden="true" tabindex="-1"></a><span class="in">funds_exp &lt;- exp_allyears %&gt;% </span></span>
<span id="cb12-503"><a href="#cb12-503" aria-hidden="true" tabindex="-1"></a><span class="in">  distinct(fund, fund_name) %&gt;% </span></span>
<span id="cb12-504"><a href="#cb12-504" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(!is.na(fund_name))</span></span>
<span id="cb12-505"><a href="#cb12-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-506"><a href="#cb12-506" aria-hidden="true" tabindex="-1"></a><span class="in">funds_ab_in = readxl::read_excel("inputs/funds_ab_in.xlsx")</span></span>
<span id="cb12-507"><a href="#cb12-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-508"><a href="#cb12-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-509"><a href="#cb12-509" aria-hidden="true" tabindex="-1"></a><span class="in">exp_temp &lt;- exp_allyears %&gt;% </span></span>
<span id="cb12-510"><a href="#cb12-510" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-fund_name) %&gt;%</span></span>
<span id="cb12-511"><a href="#cb12-511" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(fund, fy)  %&gt;%</span></span>
<span id="cb12-512"><a href="#cb12-512" aria-hidden="true" tabindex="-1"></a><span class="in"># join  funds_ab_in  to exp_temp</span></span>
<span id="cb12-513"><a href="#cb12-513" aria-hidden="true" tabindex="-1"></a><span class="in">  left_join(funds_ab_in, by = "fund")</span></span>
<span id="cb12-514"><a href="#cb12-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-515"><a href="#cb12-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-516"><a href="#cb12-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-517"><a href="#cb12-517" aria-hidden="true" tabindex="-1"></a><span class="in"># Agency == 799 for Statutory transfers </span></span>
<span id="cb12-518"><a href="#cb12-518" aria-hidden="true" tabindex="-1"></a><span class="in">#  Object == 1993 is for Interfund cash transfers  </span></span>
<span id="cb12-519"><a href="#cb12-519" aria-hidden="true" tabindex="-1"></a><span class="in">exp_temp &lt;- exp_temp %&gt;% </span></span>
<span id="cb12-520"><a href="#cb12-520" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(transfer = ifelse(org_name == "TRANSFERS", 1, 0),</span></span>
<span id="cb12-521"><a href="#cb12-521" aria-hidden="true" tabindex="-1"></a><span class="in">         trans_agency = ifelse(org_name == "TRANSFERS", </span></span>
<span id="cb12-522"><a href="#cb12-522" aria-hidden="true" tabindex="-1"></a><span class="in">                               str_sub(obj_seq_type,1,3), NA),</span></span>
<span id="cb12-523"><a href="#cb12-523" aria-hidden="true" tabindex="-1"></a><span class="in">         trans_type = ifelse(org_name == "TRANSFERS", </span></span>
<span id="cb12-524"><a href="#cb12-524" aria-hidden="true" tabindex="-1"></a><span class="in">                             str_sub(obj_seq_type, 4,9), NA)) %&gt;%   </span></span>
<span id="cb12-525"><a href="#cb12-525" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb12-526"><a href="#cb12-526" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(</span></span>
<span id="cb12-527"><a href="#cb12-527" aria-hidden="true" tabindex="-1"></a><span class="in">         object = ifelse(transfer == 0, as.character(str_sub(obj_seq_type, 1, 4)), NA_character_),  # appropriation object</span></span>
<span id="cb12-528"><a href="#cb12-528" aria-hidden="true" tabindex="-1"></a><span class="in">         sequence = ifelse(transfer == 0, as.character(str_sub(obj_seq_type, 5,6)), NA_character_),</span></span>
<span id="cb12-529"><a href="#cb12-529" aria-hidden="true" tabindex="-1"></a><span class="in">         type = ifelse(transfer == 0, str_sub(obj_seq_type, 7,8), NA_character_)    # appropriation type</span></span>
<span id="cb12-530"><a href="#cb12-530" aria-hidden="true" tabindex="-1"></a><span class="in">         )</span></span>
<span id="cb12-531"><a href="#cb12-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-532"><a href="#cb12-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-533"><a href="#cb12-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-534"><a href="#cb12-534" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the initial combined and years of data are saved as dataframes named <span class="in">`exp_allyears`</span> and <span class="in">`rev_allyears`</span>. These are then saved as exp_temp and rev_temp while recoding variables. This is BEFORE creating Fiscal Future category groups and further data cleaning done in the Calculating the Fiscal Gap page.</span>
<span id="cb12-535"><a href="#cb12-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-536"><a href="#cb12-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r remove-all_obs_df, include=FALSE}</span></span>
<span id="cb12-537"><a href="#cb12-537" aria-hidden="true" tabindex="-1"></a><span class="in">rm(allexpfiles)</span></span>
<span id="cb12-538"><a href="#cb12-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-539"><a href="#cb12-539" aria-hidden="true" tabindex="-1"></a><span class="in">rm(allrevfiles)</span></span>
<span id="cb12-540"><a href="#cb12-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-541"><a href="#cb12-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-542"><a href="#cb12-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-543"><a href="#cb12-543" aria-hidden="true" tabindex="-1"></a>Update Agencies: Some agencies have merged with others or changed names over time.</span>
<span id="cb12-544"><a href="#cb12-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-545"><a href="#cb12-545" aria-hidden="true" tabindex="-1"></a>**\[\[ TO DO: Add appendix item of Current agencies (with indented past agencies) from the Methodology Document. \]\]**</span>
<span id="cb12-546"><a href="#cb12-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-547"><a href="#cb12-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r agencies-exp}</span></span>
<span id="cb12-548"><a href="#cb12-548" aria-hidden="true" tabindex="-1"></a><span class="in"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb12-549"><a href="#cb12-549" aria-hidden="true" tabindex="-1"></a><span class="in">exp_temp &lt;- exp_temp %&gt;% </span></span>
<span id="cb12-550"><a href="#cb12-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-551"><a href="#cb12-551" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(agency = case_when(</span></span>
<span id="cb12-552"><a href="#cb12-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-553"><a href="#cb12-553" aria-hidden="true" tabindex="-1"></a><span class="in">    (agency=="438"| agency=="475" |agency == "505") ~ "440",</span></span>
<span id="cb12-554"><a href="#cb12-554" aria-hidden="true" tabindex="-1"></a><span class="in">    # financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb12-555"><a href="#cb12-555" aria-hidden="true" tabindex="-1"></a><span class="in">     # banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb12-556"><a href="#cb12-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-557"><a href="#cb12-557" aria-hidden="true" tabindex="-1"></a><span class="in">    agency == "473" ~ "588", # nuclear safety moved into IEMA</span></span>
<span id="cb12-558"><a href="#cb12-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-559"><a href="#cb12-559" aria-hidden="true" tabindex="-1"></a><span class="in">    (agency =="531" | agency =="577") ~ "532", # coded as EPA</span></span>
<span id="cb12-560"><a href="#cb12-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-561"><a href="#cb12-561" aria-hidden="true" tabindex="-1"></a><span class="in">    (agency =="556" | agency == "538") ~ "406", # coded as agriculture</span></span>
<span id="cb12-562"><a href="#cb12-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-563"><a href="#cb12-563" aria-hidden="true" tabindex="-1"></a><span class="in">    agency == "560" ~ "592", # IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb12-564"><a href="#cb12-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-565"><a href="#cb12-565" aria-hidden="true" tabindex="-1"></a><span class="in">    agency == "570" &amp; fund == "0011" ~ "494",   # city of Chicago road fund to transportation</span></span>
<span id="cb12-566"><a href="#cb12-566" aria-hidden="true" tabindex="-1"></a><span class="in">    TRUE ~ (as.character(agency)))) </span></span>
<span id="cb12-567"><a href="#cb12-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-568"><a href="#cb12-568" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb12-569"><a href="#cb12-569" aria-hidden="true" tabindex="-1"></a><span class="in"># exp_temp &lt;- exp_temp %&gt;% filter(!is.na(fy))</span></span>
<span id="cb12-570"><a href="#cb12-570" aria-hidden="true" tabindex="-1"></a><span class="in"># ## Fill in missing names for funds</span></span>
<span id="cb12-571"><a href="#cb12-571" aria-hidden="true" tabindex="-1"></a><span class="in"># exp_temp &lt;- exp_temp  %&gt;%</span></span>
<span id="cb12-572"><a href="#cb12-572" aria-hidden="true" tabindex="-1"></a><span class="in">#   select(-c(agency_name)) %&gt;%</span></span>
<span id="cb12-573"><a href="#cb12-573" aria-hidden="true" tabindex="-1"></a><span class="in">#   left_join(funds_exp) %&gt;%</span></span>
<span id="cb12-574"><a href="#cb12-574" aria-hidden="true" tabindex="-1"></a><span class="in">#   left_join(agencies_exp)</span></span>
<span id="cb12-575"><a href="#cb12-575" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-576"><a href="#cb12-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-577"><a href="#cb12-577" aria-hidden="true" tabindex="-1"></a>For aggregating revenue, use the <span class="in">`rev_allyears`</span> file, join the <span class="in">`funds_ab_in`</span> file to it, and then join the <span class="in">`ioc_source_type`</span> file. Remember: You need to update the <span class="in">`funds_ab_in`</span> and <span class="in">`ioc_source_type`</span> file every year!</span>
<span id="cb12-578"><a href="#cb12-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-581"><a href="#cb12-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-582"><a href="#cb12-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb12-583"><a href="#cb12-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-584"><a href="#cb12-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-585"><a href="#cb12-585" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(rev_allyears, funds_ab_in, <span class="at">by =</span> <span class="st">"fund"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-586"><a href="#cb12-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(source) </span>
<span id="cb12-587"><a href="#cb12-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-588"><a href="#cb12-588" aria-hidden="true" tabindex="-1"></a>funds_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(fund, fund_name_ab) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fund_name_ab))</span>
<span id="cb12-589"><a href="#cb12-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-590"><a href="#cb12-590" aria-hidden="true" tabindex="-1"></a>agencies_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(agency, agency_name) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(agency_name)) <span class="sc">%&gt;%</span></span>
<span id="cb12-591"><a href="#cb12-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">as.character</span>(agency))</span>
<span id="cb12-592"><a href="#cb12-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-593"><a href="#cb12-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-594"><a href="#cb12-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-595"><a href="#cb12-595" aria-hidden="true" tabindex="-1"></a><span class="co"># need to update the ioc_source_type file every year! </span></span>
<span id="cb12-596"><a href="#cb12-596" aria-hidden="true" tabindex="-1"></a>ioc_source_type <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"./inputs/ioc_source.xlsx"</span>)</span>
<span id="cb12-597"><a href="#cb12-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-598"><a href="#cb12-598" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(rev_temp, ioc_source_type, <span class="at">by =</span> <span class="st">"source"</span>)</span>
<span id="cb12-599"><a href="#cb12-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-600"><a href="#cb12-600" aria-hidden="true" tabindex="-1"></a>sources_rev <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb12-601"><a href="#cb12-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(source, source_name_AWM) <span class="sc">%&gt;%</span> </span>
<span id="cb12-602"><a href="#cb12-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(source_name_AWM))</span>
<span id="cb12-603"><a href="#cb12-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-604"><a href="#cb12-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-605"><a href="#cb12-605" aria-hidden="true" tabindex="-1"></a><span class="co"># fund info to revenue for all years</span></span>
<span id="cb12-606"><a href="#cb12-606" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb12-607"><a href="#cb12-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(fund_name, agency_name, </span>
<span id="cb12-608"><a href="#cb12-608" aria-hidden="true" tabindex="-1"></a>            source_name_AWM))  <span class="sc">%&gt;%</span> </span>
<span id="cb12-609"><a href="#cb12-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(funds_rev) <span class="sc">%&gt;%</span></span>
<span id="cb12-610"><a href="#cb12-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sources_rev)</span>
<span id="cb12-611"><a href="#cb12-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-612"><a href="#cb12-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-613"><a href="#cb12-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-614"><a href="#cb12-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-615"><a href="#cb12-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-616"><a href="#cb12-616" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically used source, source name does not match for the join to work using source_name</span></span>
<span id="cb12-617"><a href="#cb12-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-618"><a href="#cb12-618" aria-hidden="true" tabindex="-1"></a><span class="co"># recodes old agency numbers to consistent agency number</span></span>
<span id="cb12-619"><a href="#cb12-619" aria-hidden="true" tabindex="-1"></a>rev_temp <span class="ot">&lt;-</span> rev_temp <span class="sc">%&gt;%</span> </span>
<span id="cb12-620"><a href="#cb12-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-621"><a href="#cb12-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agency =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-622"><a href="#cb12-622" aria-hidden="true" tabindex="-1"></a>    (agency<span class="sc">==</span><span class="st">"438"</span><span class="sc">|</span> agency<span class="sc">==</span><span class="st">"475"</span> <span class="sc">|</span>agency <span class="sc">==</span> <span class="st">"505"</span>) <span class="sc">~</span> <span class="st">"440"</span>, <span class="co"># financial institution &amp;  professional regulation &amp;</span></span>
<span id="cb12-623"><a href="#cb12-623" aria-hidden="true" tabindex="-1"></a>     <span class="co"># banks and real estate  --&gt; coded as  financial and professional reg</span></span>
<span id="cb12-624"><a href="#cb12-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-625"><a href="#cb12-625" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"473"</span> <span class="sc">~</span> <span class="st">"588"</span>, <span class="co"># nuclear safety moved into IEMA</span></span>
<span id="cb12-626"><a href="#cb12-626" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"531"</span> <span class="sc">|</span> agency <span class="sc">==</span><span class="st">"577"</span>) <span class="sc">~</span> <span class="st">"532"</span>, <span class="co"># coded as EPA</span></span>
<span id="cb12-627"><a href="#cb12-627" aria-hidden="true" tabindex="-1"></a>    (agency <span class="sc">==</span><span class="st">"556"</span> <span class="sc">|</span> agency <span class="sc">==</span> <span class="st">"538"</span>) <span class="sc">~</span> <span class="st">"406"</span>, <span class="co"># coded as agriculture</span></span>
<span id="cb12-628"><a href="#cb12-628" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"560"</span> <span class="sc">~</span> <span class="st">"592"</span>, <span class="co"># IL finance authority (fire trucks and agriculture stuff)to state fire marshal</span></span>
<span id="cb12-629"><a href="#cb12-629" aria-hidden="true" tabindex="-1"></a>    agency <span class="sc">==</span> <span class="st">"570"</span> <span class="sc">&amp;</span> fund <span class="sc">==</span> <span class="st">"0011"</span> <span class="sc">~</span> <span class="st">"494"</span>,   <span class="co"># city of Chicago road fund to transportation</span></span>
<span id="cb12-630"><a href="#cb12-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-631"><a href="#cb12-631" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> (<span class="fu">as.character</span>(agency)))) <span class="sc">%&gt;%</span></span>
<span id="cb12-632"><a href="#cb12-632" aria-hidden="true" tabindex="-1"></a>  <span class="co">#left_join(sources_rev) %&gt;%</span></span>
<span id="cb12-633"><a href="#cb12-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(agencies_rev) <span class="co"># add correct agency names back in</span></span>
<span id="cb12-634"><a href="#cb12-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-635"><a href="#cb12-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-636"><a href="#cb12-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-637"><a href="#cb12-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Export Intermediate Files</span></span>
<span id="cb12-638"><a href="#cb12-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-639"><a href="#cb12-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb12-640"><a href="#cb12-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-641"><a href="#cb12-641" aria-hidden="true" tabindex="-1"></a><span class="in">write_csv(rev_temp, file = paste0("./data/FY", current_year, " Files/rev_temp.csv"))</span></span>
<span id="cb12-642"><a href="#cb12-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-643"><a href="#cb12-643" aria-hidden="true" tabindex="-1"></a><span class="in">write_csv(exp_temp, file = paste0("./data/FY", current_year, " Files/exp_temp.csv"))</span></span>
<span id="cb12-644"><a href="#cb12-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-645"><a href="#cb12-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-646"><a href="#cb12-646" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb12-647"><a href="#cb12-647" aria-hidden="true" tabindex="-1"></a>The <span class="in">`exp_temp.csv`</span> file and <span class="in">`rev_temp.csv`</span> file are most likely the data that non-Fiscal Future researchers would want to use for their own analyses. These files should have consistent agencies and funds tracked from 1998 to the present.</span>
<span id="cb12-648"><a href="#cb12-648" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>